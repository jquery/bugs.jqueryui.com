<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9635 (Sortable: Item flying off screen with revert=true) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9634/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9636/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#9635</a>
      <span class="ticket-status">open</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">()</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened October 28, 2013 10:43AM UTC</p>
      
      
        <p>Last modified October 31, 2016 08:23PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Sortable: Item flying off screen with revert=true</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        the-razer
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.sortable</td>
      
        <th>Version:</th>
      
      <td>1.10.3</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hi,</p><p>When you're dropping a list item on a scrolled page, the item flies off screen by the distance you scrolled down and then returns to the placeholder. Here's a showcase: <a href="http://jsfiddle.net/DZ6x4/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/DZ6x4/</a></p><p>I have this bug at least with current Firefox and IE. I use jQuery 1.9.1 and jQuery-UI 1.10.3, the JSFiddle has different versions but it's the same problem (I was not able to include it otherwise, sorry).</p><p>It seems that changing in ''jquery.ui.sortable.js'':</p><pre class="wiki">
if ( !axis || axis === "y" ) {
    animation.top = cur.top - this.offset.parent.top - this.margins.top; // + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop);
}
</pre><p>to:</p><pre class="wiki">
if ( !axis || axis === "y" ) {
    animation.top = cur.top - this.offset.parent.top - this.margins.top;
}
</pre><p>solves this for me, but I have no clue if that's really the problem or if I'm using it the wrong way.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 28, 2013 10:46AM UTC by <span class="author">the-razer</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">the original code is of course:&#92;
{{{&#92;
if ( !axis || axis === &quot;y&quot; ) {&#92;
    animation.top = cur.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop);&#92;
}&#92;
}}}&#92;
Sorry</span> → <span class="change-field-new">1382962381263275</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>the original code is of course:</p><pre class="wiki">
if ( !axis || axis === "y" ) {
    animation.top = cur.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop);
}
</pre><p>and I seem to have messed up JSFiddle. Here's the correct link now: <a href="http://jsfiddle.net/DZ6x4/6/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/DZ6x4/6/</a></p><p>That's my first time reporting a bug, so please bear with me</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 28, 2013 01:01PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks the-razer.</p><p>You don't need a placeholder to duplicate the issue - <a href="http://jsfiddle.net/NnQAm/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/NnQAm/.</a> This is possibly a duplicate of <a href="/ticket/5039">#5039</a>.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 25, 2014 04:45PM UTC by <span class="author">colin.mccabe</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I too see this issue although I have a complex situation where a sortable ul element is inside an absolutely positioned, scrollable parent that is not the document body.  This situation has been discussed at length in many places and none of the solutions provided have worked for me.  Upon deeper inspection it turns out to be variable initialization issue in ui.sortable.  Below shows lines 12210-12222 from the combined jquery-ui-1.10.4.js library.  </p><pre class="wiki">
		$.extend(this.offset, {
			click: { //Where the click happened, relative to the element
				left: event.pageX - this.offset.left,
				top: event.pageY - this.offset.top
			},
			parent: this._getParentOffset(),
			relative: this._getRelativeOffset() //This is a relative to absolute position minus the actual position calculation - only used for relative positioned helper
		});

		// Only after we got the offset, we can change the helper's position to absolute
		// TODO: Still need to figure out a way to make relative sorting possible
		this.helper.css("position", "absolute");
		this.cssPosition = this.helper.css("position");
</pre><p>_getParentOffset() is used to calculate this.offset.parent.top which is critical to correctly (vertically) positioning an item being dragged.  The _getParentOffset in turn used relies on this.cssPosition to be "absolute" in this situation.  Unfortunately this.cssPosition is not initialized until after the call to _getParentOffset so is.offset.parent.top is calculated incorrectly the first time an item is dragged.  I hope this provides insight into the issue.  I will also work on providing a fiddle as an exemplar.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 22, 2016 08:52AM UTC by <span class="author">marioheuvel</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>After this many months, this bug still appears in Internet Explorer 11.</p><p><a href="http://pastebin.com/LRsyma59" class="ext-link"><span class="icon"></span>http://pastebin.com/LRsyma59</a></p><p>Would be nice if a permanent fix was available. :(</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 31, 2016 08:23PM UTC by <span class="author">Snoturky</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:3 colin.mccabe]:</p><blockquote> I too see this issue although I have a complex situation where a sortable ul element is inside an absolutely positioned, scrollable parent that is not the document body.  This situation has been discussed at length in many places and none of the solutions provided have worked for me.  Upon deeper inspection it turns out to be variable initialization issue in ui.sortable.  Below shows lines 12210-12222 from the combined jquery-ui-1.10.4.js library.    <pre class="wiki">
&gt; 		$.extend(this.offset, {
&gt; 			click: { //Where the click happened, relative to the element
&gt; 				left: event.pageX - this.offset.left,
&gt; 				top: event.pageY - this.offset.top
&gt; 			},
&gt; 			parent: this._getParentOffset(),
&gt; 			relative: this._getRelativeOffset() //This is a relative to absolute position minus the actual position calculation - only used for relative positioned helper
&gt; 		});
&gt; 
&gt; 		// Only after we got the offset, we can change the helper's position to absolute
&gt; 		// TODO: Still need to figure out a way to make relative sorting possible
&gt; 		this.helper.css("position", "absolute");
&gt; 		this.cssPosition = this.helper.css("position");
&gt; </pre>  _getParentOffset() is used to calculate this.offset.parent.top which is critical to correctly (vertically) positioning an item being dragged.  The _getParentOffset in turn used relies on this.cssPosition to be "absolute" in this situation.  Unfortunately this.cssPosition is not initialized until after the call to _getParentOffset so is.offset.parent.top is calculated incorrectly the first time an item is dragged.  I hope this provides insight into the issue.  I will also work on providing a fiddle as an exemplar.</blockquote><p></p><hr><p></p><p>This is exactly what I have found. The first time you drag an element after sortable is constructed, the positioning is wrong. But after the first time it works because </p><pre class="wiki">cssPosition = 'absolute'</pre>.<p></p><p>There is a simple work-around. set cssPosition to 'absolute' right after construction, before the user has a chance to drag an element.</p><pre class="wiki">
$('.my-sortable').sortable({
  /* options to construct the sortable */
});
$('.my-sortable').sortable('instance').cssPosition = 'absolute';
</pre><p>Tested on jQuery UI Sortable 1.12.1</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
