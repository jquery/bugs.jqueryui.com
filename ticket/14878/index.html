<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14878 (Buggy Collision Detection UI-Sortable) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14869/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14883/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#14878</a>
      <span class="ticket-status">new</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">()</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened November 28, 2015 08:56AM UTC</p>
      
      
        <p>Last modified July 26, 2016 03:41PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Buggy Collision Detection UI-Sortable</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        AzuObs
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.sortable</td>
      
        <th>Version:</th>
      
      <td>1.11.3</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hello, </p><p>This is my first bug report to any project really. I've read your guidelines but please provide any guidance and feedback so that I can do better in the future. If you have any questions at the end of this then please let me know. I can submit a video if it's really needed, but the bug should be easy to reproduce. </p><h2>BUG DESCRIPTION</h2><p>JS fiddle: <a href="http://jsfiddle.net/AzuObs/cp8c6xyf/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/AzuObs/cp8c6xyf/.</a></p><p>Imgur: <a href="http://imgur.com/fHghiK9" class="ext-link"><span class="icon"></span>http://imgur.com/fHghiK9</a></p><p>The ui-sortable-helper does not detect properly when their is a collision with the other sortable-handles in the list. In my fiddle, if you drag "ITEM 1"  and enter "ITEM 2" from the right border or left border and with no downward drag on your mouse; either a pure horizontal mouse-motion or, a horizontal and upward mouse-motion, then the library will not trigger a CHANGE event. </p><p>Indeed, the library will only trigger a CHANGE event when entering the list through the top and bottom borders or using a downward motion if entered form the side borders.</p><p>Note that I am using the sort option { tolerance : "pointer" } and that this is unexpected behavior and definitely does not feel good as a user. When I have my mouse over the element I want to sort - it should sort and trigger a CHANGE event no matter which angle I came from.</p><h2>EXPLANATION</h2><p>The main code in the _mouseDrag event does this;</p><p>A) _intersectWithPointer(item)</p><p>return false OR 1 OR 2</p><p>false: no collision</p><p>1 OR 2: collision with mouse coming from direction "X". Depends if list is horizontal or vertical and the delta: mousePosition - mousePreviousPosition. Logic is saying something like if "1" then the mouse drag was downard and rightwards, and if "2" then mouse drag was upwards and leftwards</p><p>B) placeHolder [ "next" OR "prev" ] - is the previous OR next element the same as our helper? </p><p>"prev" or "next" depends on the return value of _intersectWithPointer</p><p>C) call triggerChangeEvent</p><p>The problem here is that this works fine as long as your mouse stays within the list that contains the sortable elements, but acts buggy if you leave it and reenter from an axis opposite to that of the list. These sort of checks based on mouse direction are kind of prone to hidden bugs because you can enter a UI element from 4 different directions, and yet in this case only a single horizontal OR vertical direction will yield the expected behavior.</p><p>The current design is really not needed for what we want to do. We are not sorting things based on the direction our mouse is going in; we are sorting them based on where they are on the screen compared to our mouse pointer. It's also adds to the complexity, and although I'm a beginner it took me a long time to understand where my error was coming from, and then fix. So, the design could perhaps be improved to limit this error from happening in the future.  </p><h2>OFFERED SOLUTION</h2><p>JS Fiddle: <a href="http://jsfiddle.net/AzuObs/cgh7xvpv/9/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/AzuObs/cgh7xvpv/9/</a></p><p>A) Have _intersectWithPointer only return TRUE or FALSE - this means that the mouse collides with AN item but it could just be itself at this stage</p><pre class="wiki">
_intersectsWithPointer: function(item) {
  var isOverElementHeight = (this.options.axis === "x") || this._isOverAxis(this.positionAbs.top + this.offset.click.top, item.top, item.height);
  var isOverElementWidth = (this.options.axis === "y") || this._isOverAxis(this.positionAbs.left + this.offset.click.left, item.left, item.width);

  return isOverElementHeight && isOverElementWidth;
}
</pre><p>B) Delete the check: if placeholder[ "next" OR "prev" ] is the previous element our helper</p><p>C) Inside the final check, just before called this._trigger("change"...)</p><pre class="wiki">
// create position of placeholder and currentItem
var placeHoldPos = {
  x: this.placeholder[0].offsetLeft + this.placeholder[0].offsetWidth,
  y: this.placeholder[0].offsetTop + this.placeholder[0].offsetHeight
};
			
var currentItemPos = {
  x: this.currentItem[0].offsetLeft + this.currentItem[0].offsetWidth,
  y: this.currentItem[0].offsetTop + this.currentItem[0].offsetHeight
};
	
// direction of the collision?
if (this.floating) {
  if (placeHoldPos.x &lt; currentItemPos.x) {
    this.direction = "up";
  } else {
    this.direction = "down";
  }
} else {
  if (placeHoldPos.y &lt; currentItemPos.y) {
    this.direction = "up";
  } else {
    this.direction = "down";
  }
}
</pre><p>D) Time/Space complexity are still the same. You could tinker around with the _intersectWithPointer to return values between 1-9 if you wanted to keep in the original style - but honestly it's not worth keeping that system IMO as it's complicated and subject to hidden bugs like this one. </p><p>I hope that you like my fix. If you would like me to explain then I can but I think that it is simple. Also, I would really appreciate the chance to contribute and make a pull to the project as I've never done anything like that before :-)</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (1)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 26, 2016 03:41PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">ui.core</span> → <span class="change-field-new">ui.sortable</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
