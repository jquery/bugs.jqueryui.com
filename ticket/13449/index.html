<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13449 (jQuery UI assumes that jQuery is loadable via AMD just because an AMD environment is present.) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13359/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13473/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#13449</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened July 06, 2015 04:58AM UTC</p>
      
        <p>Closed July 06, 2015 12:23PM UTC</p>
      
      
        <p>Last modified May 20, 2017 06:19AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery UI assumes that jQuery is loadable via AMD just because an AMD environment is present.</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        maratbn
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.core</td>
      
        <th>Version:</th>
      
      <td>1.11.4</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Certain websites, especially the kind which may mix various 3rd party plugins / modules / widgets on one page, such as websites running <a href="/wiki/WordPress">WordPress</a> and similar CMSes, may end up with a mix of various <a href="/wiki/JavaScript">JavaScript</a> loading environments present on a single page.  For instance, one CMS plugin may load an AMD environment such as <a href="/wiki/RequireJS">RequireJS</a> via a &lt;script&gt; tag, and another plugin, unaware of the AMD-using plugin, may load jQuery and jQuery UI also via &lt;script&gt; tags.</p><p>The current implementation of jQuery UI core assumes that if an AMD environment is detected that means that jQuery is also available via AMD, and immediately attempts to load it via that method.  However, as described above, that is an incorrect assumption, and this logic will cause an error if jQuery is not actually available via AMD.</p><p>As demonstrated here:  <a href="http://jsfiddle.net/wp9ebxbL/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/wp9ebxbL/</a></p><p>Make sure to open browser <a href="/wiki/JavaScript">JavaScript</a> console before clicking 'Run' to see the error from <a href="/wiki/RequireJS">RequireJS</a>.</p><p>jQuery UI needs to first check if jQuery is in fact available via AMD before trying to load it, and if not, then it should just revert to using jQuery in the global namespace.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 06, 2015 05:14AM UTC by <span class="author">maratbn</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <pre class="wiki">
diff --git a/ui/core.js b/ui/core.js
index 9ac196d..57cabd8 100644
--- a/ui/core.js
+++ b/ui/core.js
@@ -15,7 +15,10 @@
 //&gt;&gt;demos: http://jqueryui.com/
 
 ( function( factory ) {
-       if ( typeof define === "function" && define.amd ) {
+       if ( typeof define === "function" && define.amd &&
+                typeof require === "function" &&
+                typeof require.specified === "function" &&
+                require.specified("jquery") ) {
 
                // AMD. Register as an anonymous module.
                define( [ "jquery" ], factory );
</pre><p>A patch for this issue might look like something like this above; however, this exact patch should not be applied because the functions 'require(...)' and 'require.specified(...)' are only available in <a href="/wiki/RequireJS">RequireJS</a> and are not a part of the AMD standard at this time.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 06, 2015 12:23PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is definitely not a common implementation. You should just create a shim that exposes jQuery via AMD. Having AMD support that mixes in global support doesn't make too much sense.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 07, 2015 05:07AM UTC by <span class="author">maratbn</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 scott.gonzalez]:</p><blockquote> This is definitely not a common implementation. You should just create a shim that exposes jQuery via AMD. Having AMD support that mixes in global support doesn't make too much sense.</blockquote><p>I think you misunderstood me.  I'm not talking about deliberately creating such an implementation.</p><p>What I'm saying is that under certain circumstances, such an implementation can be unintentionally created when 2 unrelated bundles of code, one that uses jQuery / jQuery UI, and another that uses AMD may end up deployed together on the same website, with the developers of the original code having no control over how / where their work is deployed.</p><p>The example I provided in the description above is that this can happen on any <a href="/wiki/WordPress">WordPress</a> site.  Specifically, the administrator of the <a href="/wiki/WordPress">WordPress</a> site may install one plugin / theme that loads jQuery / jQuery UI globally, and then he might also install a completely unrelated plugin / theme that loads an AMD system such as <a href="/wiki/RequireJS">RequireJS</a>.</p><p>THE ORIGINAL PLUGIN / THEME DEVELOPERS HAVE NO CONTROL OVER THIS DEPLOYMENT, BUT SUCH A PLUGIN / THEME COMBINATION WILL BREAK THE SITE.</p><p>The current implementation of jQuery UI makes it unsuitable for use in any plugin intended for plug-and-play 3rd party deployment, because under the conditions described above, the current jQuery UI logic in such a plugin will break the site.</p><p>I disagree with your statement that this is not a common implementation.  <a href="/wiki/WordPress">WordPress</a> is a very popular CMS, and it is very common for <a href="/wiki/WordPress">WordPress</a> administrators to mix multiple unrelated 3rd-party plugins / widgets on a single site.</p><p>I think that this problem should be considered a serious bug that needs to be fixed if jQuery UI is to be intended to be used safely in deployments outside the control of the original developers that integrated it into their work.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 04, 2016 05:38AM UTC by <span class="author">maratbn</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; You should just create a shim that exposes jQuery via AMD.&#92;
&#92;
Earlier I forgot to explain that &#39;shim&#39; is an AMD term, and this bug is not strictly about using jQuery from inside AMD, which is what a &#39;shim&#39; might be used for.&#92;
&#92;
In the scope of this bug, we don&#39;t even want to use AMD, we just don&#39;t want to have a conflict with some other 3rd party module on the page that happens to be using AMD.&#92;
&#92;
And even if we were using AMD, then conversely, we would not want our AMD-using module to break some other module on the page that happens to be loading jQuery and jQueryUI directly via &lt;script&gt; tags, regardless of whether we used shims or not.&#92;
&#92;
This ticket has been closed prematurely, as a result of a fundamental lack of analysis and understanding as to what it is really about.&#92;
&#92;
I predict that more people will experience difficulties due to this incompatibility, so I&#39;m still glad that I documented it here, as at least it will give them an explanation as to what is going on.</span> → <span class="change-field-new">1454564407819910</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>_comment1:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; You should just create a shim that exposes jQuery via AMD.&#92;
&#92;
Earlier I forgot to explain that &#39;shim&#39; is an AMD term, and this bug is not strictly about using jQuery from inside AMD, which is what a shim might be used for.&#92;
&#92;
In the scope of this bug, we don&#39;t even want to use AMD, we just don&#39;t want to have a conflict with some other 3rd party module on the page that happens to be using AMD.&#92;
&#92;
And even if we were using AMD, then conversely, we would not want our AMD-using module to break some other module on the page that happens to be loading jQuery and jQueryUI directly via &lt;script&gt; tags, regardless of whether we used shims or not.&#92;
&#92;
This ticket has been closed prematurely, as a result of a fundamental lack of analysis and understanding as to what it is really about.&#92;
&#92;
I predict that more people will experience difficulties due to this incompatibility, so I&#39;m still glad that I documented it here, as at least it will give them an explanation as to what is going on.</span> → <span class="change-field-new">1454564527343166</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
        
          
            <div class="ticket-comment-body">
              <blockquote> You should just create a shim that exposes jQuery via AMD.</blockquote><p>Earlier I forgot to explain that 'shim' is a <a href="/wiki/RequireJS">RequireJS</a>/AMD term, and this bug is not strictly about using jQuery from inside AMD, which is what a shim might be used for.</p><p>In the scope of this bug, we don't even want to use AMD, we just don't want to have a conflict with some other 3rd party module on the page that happens to be using AMD.</p><p>And even if we were using AMD, then conversely, we would not want our AMD-using module to break some other module on the page that happens to be loading jQuery and jQueryUI directly via &lt;script&gt; tags, regardless of whether we used <a href="/wiki/RequireJS">RequireJS</a> shims or not.</p><p>This ticket has been closed prematurely, as a result of a fundamental lack of analysis and understanding as to what it is really about.</p><p>I predict that more people will experience difficulties due to this incompatibility, so I'm still glad that I documented it here, as at least it will give them an explanation as to what is going on.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 18, 2016 02:55AM UTC by <span class="author">maratbn</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I've been hearing from people stumbling onto this problem too, asking me how I handled it.</p><p>My solution was to tweak the <a href="/wiki/RequireJS">RequireJS</a> and all AMD-compatible modules I'm using in such a way that I "namespaced" the global function names '</p><pre class="wiki">define(...)</pre>', '<pre class="wiki">require(...)</pre>', and '<pre class="wiki">requirejs(...)</pre>' to be something like '<pre class="wiki">_my_namespace__define(...)</pre>', '<pre class="wiki">_my_namespace__require(...)</pre>' and '<pre class="wiki">_my_namespace__requirejs(...)</pre>'.  This way my plugin and any 3rd party plugin end up on separate namespaces, so there can be no collision.<p></p><p>Here's a diff of how I tweaked <a href="/wiki/RequireJS">RequireJS</a>:</p><pre class="wiki">--- require_js-2.1.20-src.js	2016-02-16 22:28:53.221576000 -0800
+++ require_js-2.1.20-src--tweaked--2015-09-24--01--namespaced--plugin_StripePaymentPress--45576dbca1a4f9ff7385a89c3c1f6db4917fe2c1.js	2016-02-16 22:28:53.225578000 -0800
@@ -8,6 +8,8 @@
 /*jslint regexp: true, nomen: true, sloppy: true */
 /*global window, navigator, document, importScripts, setTimeout, opera */
 
+(function() {
+
 var requirejs, require, define;
 (function (global) {
     var req, s, head, baseElement, dataMain, src,
@@ -2101,3 +2103,9 @@
     //Set up with config info.
     req(cfg);
 }(this));
+
+window._plugin_StripePaymentPress__requirejs = requirejs;
+window._plugin_StripePaymentPress__require = require;
+window._plugin_StripePaymentPress__define = define;
+
+}).call(this);
</pre><p>And here's how I tweaked jQuery:</p><pre class="wiki">--- jquery-1.11.3.js	2016-02-16 22:28:53.201565999 -0800
+++ jquery-1.11.3--tweaked--2015-09-24--01--require_js_namespaced--4c456884bd01dd192d549715b5ef4312f4f82b12.js	2016-02-16 22:28:53.193561999 -0800
@@ -1,3 +1,8 @@
+
+
+(function(define, require, requirejs) {
+
+
 /*!
  * jQuery JavaScript Library v1.11.3
  * http://jquery.com/
@@ -10349,3 +10354,8 @@
 return jQuery;
 
 }));
+
+
+})(_plugin_StripePaymentPress__define,
+   _plugin_StripePaymentPress__require,
+   _plugin_StripePaymentPress__requirejs);
</pre><p>(If you add the 'window' prefix to the jQuery tweak as well it might not work on node.js if you want to share the same codebase between environments.)</p><p>Original <a href="/wiki/RequireJS">RequireJS</a>: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/lib/require_js-2.1.20-src.js" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/lib/require_js-2.1.20-src.js</a></p><p>Tweaked <a href="/wiki/RequireJS">RequireJS</a>: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/lib/require_js-2.1.20-src--tweaked--2015-09-24--01--namespaced--plugin_StripePaymentPress--45576dbca1a4f9ff7385a89c3c1f6db4917fe2c1.js" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/lib/require_js-2.1.20-src--tweaked--2015-09-24--01--namespaced--plugin_StripePaymentPress--45576dbca1a4f9ff7385a89c3c1f6db4917fe2c1.js</a></p><p>Original jQuery: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/le_requirejs/lib/jquery-1.11.3.js" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/le_requirejs/lib/jquery-1.11.3.js</a></p><p>Tweaked jQuery: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/le_requirejs/lib/jquery-1.11.3--tweaked--2015-09-24--01--require_js_namespaced--4c456884bd01dd192d549715b5ef4312f4f82b12.js" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/plugin/js/le_requirejs/lib/jquery-1.11.3--tweaked--2015-09-24--01--require_js_namespaced--4c456884bd01dd192d549715b5ef4312f4f82b12.js</a></p><p>So you just take any AMD module you want to use, like jQueryUI, and tweak it just like jQuery above.  Just encase the whole module into an anonymous function, and then pass that function the global variables corresponding to the new names (that you chose in your <a href="/wiki/RequireJS">RequireJS</a> tweak) of the default AMD functions.  The cool thing about this is that not only does it not require messing with the module internal logic, but this approach is completely transparent to the 'r.js' optimizer.  </p><p>Check out my build.js here: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/build.js" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/build.js</a></p><p>My build script: <a href="https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/do_minify_le_requirejs" class="ext-link"><span class="icon"></span>https://raw.githubusercontent.com/maratbn/RainbowPayPress/2bd1f5f634074312ecd21939e29f747d947388c7/do_minify_le_requirejs</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 20, 2017 06:19AM UTC by <span class="author">s5</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hello! Please consider fixing this. This exact problem is breaking my code, and should most definitely be considered a bug.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
