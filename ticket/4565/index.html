<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4565 (Creating a dialog leaks memory in IE6) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4564/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4566/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#4565</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(duplicate)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened May 30, 2009 05:44PM UTC</p>
      
        <p>Closed October 16, 2012 02:18PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Creating a dialog leaks memory in IE6</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        ncj102
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.10.0">1.10.0</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.dialog</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>ie6 memory leak dialog</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I used IE 6.0.2800 on Windows 2000 SP1.</p><p>I am using the jQuery nightly build from May 28. I also included ui.core and ui.dialog at r2623.</p><p>Merely creating a dialog seems to cause the memory leak. Here is an example:</p><p> </p><pre class="wiki">
	&lt;div id="box"&gt;
	hi
	&lt;/div&gt;
	&lt;script type="text/javascript" language="javascript"&gt;
	$(document).ready(function()
	{
		var box = $('#box');
		var boxOptions = { resizable: false,
			modal: false,
			autoOpen: false
		};

		var dialog = box.dialog(boxOptions);


	});
	&lt;/script&gt;
 </pre><p></p><p>I use sIEve to check for memory leaks. When I browse to a page containing the above, and then away, sIEve reports 12 memory leaks. If I use jQuery v1.3.2 instead of the nightly build, sIEve reports 9 memory leaks. Every time I refresh the page, it leaks about 1.3k.  IE6 via <a href="/wiki/MultipleIE">MultipleIE</a> on Windows XP seems to exhibit the same behavior, but I cannot attach sIEve to it. IE7 on XP does not appear to have this leak.</p><p>The patch supplied in <a href="/ticket/4188">#4188</a> by ivarsv does not prevent the memory leaks seen here, so I believe this issue is distinct.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 01, 2009 03:33PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">TBD</span> → <span class="change-field-new">1.8</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 07, 2009 10:57PM UTC by <span class="author">ncj102</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This does not seem to be specific to the dialog. If I create a new widget with no functionality, there is still a leak in IE6.</p><p>In the widget factory, if I comment out storage of the new object via "$.data" (lines 253 and 254), then the memory leak does not occur. There is a report in the jQuery bug tracker <a href="http://dev.jquery.com/ticket/4375" class="ext-link"><span class="icon"></span>http://dev.jquery.com/ticket/4375</a> that indicates a memory leak with $.data when circular references are stored, but I can't yet confirm that as the cause of the problem.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 08, 2009 09:17PM UTC by <span class="author">ncj102</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There are actually several memory leaks in dialog when using IE6. They end up leaking the same DOM elements, so it's difficult to tell them apart. This may mean that there is one underlying problem, but I am not yet familiar enough with jQuery to find it. I have been able to find workarounds for every leak exercised by the original example, though I do not necessarily know <strong>why</strong> they work:</p> <ul><li>Applied the patch in <a href="/ticket/4188">#4188</a> to solve the widget factory leak I mentioned in the previous comment.</li> <li>The event bound in disableSelection caused a circular reference of some kind. I added a line to the beginning of dialog.destroy that unbinds it by calling enableSelection:</li></ul><p> </p><pre class="wiki">
self.uiDialog.find("*").enableSelection();
 </pre><p></p> <ul><li>I make sure to call destroy for every dialog I create, on unload:</li></ul><p> </p><pre class="wiki">
$(window).unload(function()
{
    box.dialog('destroy');
});
 </pre><p></p> <ul><li>I made sure to set draggable to false, as draggable=true caused a leak.</li></ul><p>Here is my (supposedly) leak free version of the original code:</p><p> </p><pre class="wiki">
	&lt;script type="text/javascript" language="javascript"&gt;
		if ($.ui.version != '1.7.1')
		{
			debugger; //This patch may not apply any longer.
		}
		else
		{
			$.ui.dialog.prototype.destroy = function()
			{
				var self = this;

				self.uiDialog.find("*").enableSelection();

				(self.overlay && self.overlay.destroy());
				self.uiDialog.hide();
				self.element
			.unbind('.dialog')
			.removeData('dialog')
			.removeClass('ui-dialog-content ui-widget-content')
			.hide().appendTo('body');

				self.uiDialog.remove();

				(self.originalTitle && self.element.attr('title', self.originalTitle));

				return self;
			}
		}

		$(document).ready(function()
		{
			var box = $('#box');
			var boxOptions = { resizable: false,
				modal: false,
				autoOpen: false
			};

			box.dialog(boxOptions);
			
			$('#msg').text('Working2');

			$(window).unload(function()
			{
				box.dialog('destroy');
			});
		});
	&lt;/script&gt;
 </pre><p></p><p>Remember that this is only leak free in conjunction with the patch from <a href="/ticket/4188">#4188</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 14, 2011 03:08PM UTC by <span class="author">inspiraller</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, this is hilarious. I have been trying to figure out why using jquery ui dialog suddenly causes IE to go from 20kb to 350kb of memory. The reason is the css. Using @ symbols truly F**** IE. Also, if you have a lot of css, it screws it up too. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 11, 2012 02:47PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.9.0</span> → <span class="change-field-new">1.10.0</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 16, 2012 02:18PM UTC by <span class="author">bavanyo</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ duplicate</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Duplicate of <a href="/ticket/4188">#4188</a>.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
