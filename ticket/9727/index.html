<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9727 (Sortable: .cancel() ignores comment nodes (causes problems with AngularJS)) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9726/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9728/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#9727</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened January 04, 2014 07:07AM UTC</p>
      
        <p>Closed January 04, 2014 07:30PM UTC</p>
      
      
        <p>Last modified January 22, 2015 03:15PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Sortable: .cancel() ignores comment nodes (causes problems with AngularJS)</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        egrajeda
      </td>
      <th>Owned by:</th>
      <td>egrajeda</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.sortable</td>
      
        <th>Version:</th>
      
      <td>1.10.3</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p><strong>The version(s) of jQuery affected</strong></p><p>jQuery 1.10.2+ and jQuery UI 1.10.3+</p><p><strong>The browser (or browsers) that you are able to reproduce the bug in, including version numbers</strong></p><p>Any browser. Personally I tested it on Chromium Version 31.0.1650.63 Ubuntu 13.04</p><p><strong>The operating system (or operating systems) you experienced the bug on.</strong></p><p>Ubuntu 13.04</p><p><strong>Description</strong></p><p>Hello,</p><p><a href="/wiki/AngularJS">AngularJS</a> uses comment nodes to store information. The sortable component (probably other components aswell) uses jQuery .prev()/.next() to traverse the DOM. The problem is that these functions don't recognize comment nodes, so for instance when I use sortable.cancel(), the dragged element should be inserted back in the same spot it originally was; but this is not happening because the comment nodes are being ignored.</p><p>I have setup a basic demo here:</p><p><a href="http://plnkr.co/edit/kLeMRjPqEVZ1NZtCyrZH?p=preview" class="ext-link"><span class="icon"></span>http://plnkr.co/edit/kLeMRjPqEVZ1NZtCyrZH?p=preview</a></p><p>In its initial state, the sortable-related elements looks like this:</p><p>[[Image(<a href="http://i.imgur.com/0m466Sj.jpg)" class="ext-link"><span class="icon"></span>http://i.imgur.com/0m466Sj.jpg)</a>]]</p><p>If you try to drag "Item A", after you drop it the code will automatically call sortable.cancel() for you. The elements will now look like this:</p><p>[[Image(<a href="http://i.imgur.com/gPULUxy.jpg)" class="ext-link"><span class="icon"></span>http://i.imgur.com/gPULUxy.jpg)</a>]]</p><p>If you see, the "Item A" &lt;li&gt; tag should be after the first comment, but it is inserted back before it.</p><p>This might seem like a small issue, but it can make a difference between a broken sortable:</p><p><a href="http://plnkr.co/edit/BVpHl8iZyKfI4snvrafR?p=preview" class="ext-link"><span class="icon"></span>http://plnkr.co/edit/BVpHl8iZyKfI4snvrafR?p=preview</a></p><p>and a working one:</p><p><a href="http://plnkr.co/edit/i6lAv57wW0J7UtIAZcbT?p=preview" class="ext-link"><span class="icon"></span>http://plnkr.co/edit/i6lAv57wW0J7UtIAZcbT?p=preview</a></p><p>This last demo is using a modified version of the sortable code; instead of using .prev() I'm using .previousSibling.</p><p>I can submit a PR, but I wanted to add this here first to know if there is anything against this.</p><p>Thanks!</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 03:28PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Angular is using HTML comment nodes to denote important document structure, which isn't what they are meant for. jQuery's Core methods like <code>.next()</code> have always either skipped or removed comment nodes, so we can't change those semantics without breaking a lot of code. </p><p>So that leaves the option of having jQuery UI and others skip the jQuery Core APIs to make this work properly in Angular. Essentially, UI would need to say "our components guarantee that comment nodes won't be ignored or removed" which is a pretty big guarantee to make. You've found one case, but as you noted this probably affects other components as well.</p><p>This just seems like the wrong direction to me. Longer term there will be a non-hacky standard way to build components via <a href="/wiki/ShadowRoot">ShadowRoot</a>, and as I understood it the Angular team was committed to migrating to that. I understand the feeling behind this patch, "it's just a small change" and "it fixes the problem I'm seeing" but having us commit to the support it implies could open up a big can of worms.</p><p>Angular proponents seem to be pretty down on jQuery in general because they feel like it's the wrong way to do things. What would be the "Angular way" to implement Sortable?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 03:31PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1 dmethvin</p><p>egrajeda: Could you provide the specific patch you used in a gist or a pull request? I'm curious if it's possible to build a lightweight extension for Angular users.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 03:38PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ egrajeda</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 07:15PM UTC by <span class="author">egrajeda</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>dmethvin: I agree with most of what you say; in fact, I've opened an issue in <a href="/wiki/AngularJS">AngularJS</a> aswell (<a href="https://github.com/angular/angular.js/issues/5619" class="ext-link"><span class="icon"></span>https://github.com/angular/angular.js/issues/5619</a>) to see what is to be done with issues like these, which arose after they used some extra comments in their ngRepeat directive. I asked there the same question as you, which would be the "Angular way" to do this?.</p><p>I think the issue with .cancel() shouldn't be seen as related to Angular; I ran accross it while trying to find an alternate way to make sortable and Angular work together, but the fact is that the purpose of .cancel() is to revert the sortable to the state prior to when the current sort was started, and currently, because of the way it is implemented, it isn't doing that when comments are involved.</p><p>tj.vantoll: I've uploaded a patch here:</p><p><a href="https://gist.github.com/egrajeda/8259186" class="ext-link"><span class="icon"></span>https://gist.github.com/egrajeda/8259186</a></p><p>I could also create a PR if you guys needed it.</p><p>Thanks!</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 07:30PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sortable is doing The Right Thing™ according to the rules of jQuery. We've never cared about comments, and I doubt we ever will. On a related note, The <code>cancel()</code> method won't exist in the rewrite. Canceling a user's interaction in the middle of the interaction is pretty bad UX.</p><p>I'm going to close this as not a bug, since comments are never supported in jQuery's API. But feel free to continue the discussion here with tj.vantoll.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 04, 2014 11:04PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>egrajeda: How about this?</p><pre class="wiki">
$.widget( "ui.sortable", $.ui.sortable, {
    _mouseStart: function() {
        this._superApply( arguments );
        this.domPosition = { prev: this.currentItem[ 0 ].previousSibling, parent: this.currentItem.parent()[ 0 ] };
    }
});
</pre><p>Example: <a href="http://jsfiddle.net/tj_vantoll/7kmJ6/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/tj_vantoll/7kmJ6/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 05, 2014 07:16AM UTC by <span class="author">egrajeda</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>tj.vantoll: Thanks! I was trying with <a href="http://www.paulirish.com/2010/duck-punching-with-jquery/" class="ext-link"><span class="icon"></span>http://www.paulirish.com/2010/duck-punching-with-jquery/</a> but I like your code better, I'll be using it in my app :).</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 05, 2014 07:55AM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:7 egrajeda]:</p><blockquote> tj.vantoll: Thanks! I was trying with <a href="http://www.paulirish.com/2010/duck-punching-with-jquery/" class="ext-link"><span class="icon"></span>http://www.paulirish.com/2010/duck-punching-with-jquery/</a> but I like your code better, I'll be using it in my app :).</blockquote><p>Awesome! It looks like we can shorten the solution a little as well.</p><pre class="wiki">
$.widget( "ui.sortable", $.ui.sortable, {
    _mouseStart: function() {
        this._superApply( arguments );
        this.domPosition.prev = this.currentItem[ 0 ].previousSibling;
    }
});
</pre><p>And just fyi, for more information on extending widgets see <a href="http://learn.jquery.com/jquery-ui/widget-factory/extending-widgets/." class="ext-link"><span class="icon"></span>http://learn.jquery.com/jquery-ui/widget-factory/extending-widgets/.</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 22, 2015 03:15PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/10800">#10800</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
