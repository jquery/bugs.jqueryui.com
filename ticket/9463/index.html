<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9463 (Autocomplete keyboard navigation) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9462/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9464/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#9463</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened July 30, 2013 04:41PM UTC</p>
      
        <p>Closed July 30, 2013 04:46PM UTC</p>
      
      
        <p>Last modified July 30, 2013 06:22PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Autocomplete keyboard navigation</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jdmx
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.autocomplete</td>
      
        <th>Version:</th>
      
      <td>1.10.3</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I have setup the autocomplete to use a label/value pair for showing data.  Everything works except for when I keyboard navigate ( using the up and down arrows ) through the menu.  Then the value is show and not the label value.</p><p>You can see the problem with the Remote JSONP datasource datasource example <a href="http://jqueryui.com/autocomplete/#remote-jsonp" class="ext-link"><span class="icon"></span>http://jqueryui.com/autocomplete/#remote-jsonp</a> .  The label displayed in the menu dropdown will not match the value in the textbox when using the keyboard up/down buttons to do the select.</p><p>I have narrowed the problem to this section of the autocomplete that handles the keyboard movements through the menu.</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
				var item = ui.item.data( "ui-autocomplete-item" );
				if ( false !== this._trigger( "focus", event, { item: item } ) ) {
					// use value to match what will end up in the input, if it was a key event
					if ( event.originalEvent && /^key/.test( event.originalEvent.type ) ) {
						this._value( item.value );
					}
				} else {
					// Normally the input is populated with the item's value as the
					// menu is navigated, causing screen readers to notice a change and
					// announce the item. Since the focus event was canceled, this doesn't
					// happen, so we update the live region so that screen readers can
					// still notice the change and announce it.
					this.liveRegion.text( item.value );
				}
  </pre><p>}}}</p><p>if I change the code by adding the line</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
 var s = item.label || item.value;
  </pre><p>}}}</p><p> and then updating the sets, then menu navigation works correctly.</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python

				var item = ui.item.data( "ui-autocomplete-item" );
				var s = item.label || item.value;
				if ( false !== this._trigger( "focus", event, { item: item } ) ) {
					// use value to match what will end up in the input, if it was a key event
					if ( event.originalEvent && /^key/.test( event.originalEvent.type ) ) {
						this._value( s );
					}
				} else {
					// Normally the input is populated with the item's value as the
					// menu is navigated, causing screen readers to notice a change and
					// announce the item. Since the focus event was canceled, this doesn't
					// happen, so we update the live region so that screen readers can
					// still notice the change and announce it.
					this.liveRegion.text( s );
				}
  </pre><p>}}}</p><p>I guess the ultimate solution would be to tie the navigation to the onchange event ( or a new event ) so that the user has the ability to change the "value" being displayed in the textbox when the next item in the list is keyboard navigated to.</p><p>I found the focus example that handles the textbox change on the navigation</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
      focus: function( event, ui ) {
        $( "#project" ).val( ui.item.label );
        return false;
      },
  </pre><p>}}}</p><p>but that seems far more cumbersome than it needs to be to get the label to show in the textbox.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2013 04:46PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This behavior is by design and is pretty clearly documented: <a href="http://api.jqueryui.com/autocomplete/#option-source" class="ext-link"><span class="icon"></span>http://api.jqueryui.com/autocomplete/#option-source</a></p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2013 05:34PM UTC by <span class="author">jdmx</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Not sure if you continue to moniter closed tickets but..</p><p>If I use the focus trick </p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
    focus: function( event, ui ) {
      $( "#project" ).val( ui.item.label );
      return false;
    },
  </pre><p>}}}</p><p>to set the the textbox value to the item label and have autoFocus: true, then I am no longer able to use the backspace key in the textbox because the keypress will redo the list, causing the first item to be focused, reseting the textbox value.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2013 05:40PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You either want the label in the text field or you want the value. You can't have both.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2013 06:18PM UTC by <span class="author">jdmx</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have not stated what I am doing clearly enough.</p><p>My use of the autocomplete is a compliation of a number of the demos listed on the site.</p><p>I am using a remote datasource to pull in the values to display and setting them to a json value/label list where the value is a number and the label is a string.   The getting of the list is done by searching on the label value.</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
  $.getJSON(this.url, qs, function (data, status, xhr) {
    var o = data[0];
    var s = '[';
    var i = 0;
    for (var key in o) {
      s += (i == 0 ? '' : ', ') + '{ "value": "' + key + '", "label": "' + o[key] + '" }';
      i++;
    }
    s += ']';
    s = $.parseJSON(s);
    c._setCache(ele, term, s);
    response(s);
  });
  </pre><p>}}}</p><p>Everything thing works the way I expect to... enter a value in the textbox and as the value is being typed in, the menu is populated with a decreasing number of selections.  If the mouse selects an item, the value of the text box is set by me when I override the select method</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
        select: function (event, ui) {
          var _id = this.name.substring(0, this.name.length - 2);
          if (document.getElementById(_id))
            document.getElementById(_id).value = ui.item.value;
          document.getElementById(this.name).value = ui.item.label;
          this.value = ui.item.label;
          return false;
        }
  </pre><p>}}}</p><p>I want the autoFocus to be set to true so that when the user tabs out of the field, the first item is selected automactically.  Without it, the user is forced to make a selection from the list before continuing.</p><p>But if the user uses the arrows keys to nav down the list, instead of showing the labels, it will show the values ( the numbers ).  If they make a selection, then it will go back to the label.</p><p>Now to fix the numbers showing up instead of the labels, I use the focus trick to get the textbox to show right.  But when autoFocus is true and focus is set to the function that resets the textbox value, I end up autoselecting the first item of the returned list and making the backspace button unusable.</p><p>So at this point, I am left with 1 of 2 options, either keep the autofocus: true but have the arrow buttons display the numbers when used OR override the focus function with autofocus: false and have to worry about a user tabbing out of the text box without physically making a selection.</p><p>To see the what I mean by tabbing, using the example <a href="http://jqueryui.com/autocomplete/#custom-data," class="ext-link"><span class="icon"></span>http://jqueryui.com/autocomplete/#custom-data,</a> type in jq and then tab out of the field.  The select function is not called so it does not change the icon and subtext.</p><p>In the src bit I provided, it allows me to control the value being displayed in the textbox while still having the autoFocus: true.  I know that the bit breaks functionality that has been documented, but instead of using the line</p><pre class="wiki">
#!div style="font-size: 90%"
  {{{#!python
var s = item.label || item.value;
  </pre><p>}}}</p><p>it would call an event that would allow for the user to provide an override, like how the focus and select overrides work, then there would not be an issue of the focus and autoFocus conflicting like I discussed above</p><p>I guess my final option is to just switch the value/label assignments so that the value is the string and the label is the number so that I can circumvent this quirk.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2013 06:22PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Tell the plugin not to update the value on focus, via <code>event.preventDefault()</code>. Set the value on select. If you need more help, please use the forums, IRC, or Stack Overflow.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
