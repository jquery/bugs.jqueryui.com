<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8866 (Menu: select event not firing due to mouseHandled flag reset bug) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8865/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8867/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#8866</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened November 28, 2012 10:36PM UTC</p>
      
        <p>Closed December 28, 2012 03:20AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Menu: select event not firing due to mouseHandled flag reset bug</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        MrBigDog2U
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.10.0">1.10.0</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.menu</td>
      
        <th>Version:</th>
      
      <td>1.9.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The ui.menu mouseHandled flag does not get reset properly when creating a menu within an event handler other than a button click.</p><p>The first time a menu is shown, the mouseHandled flag is set to false and the control works correctly.  The .ui-menu-item click handler sets the mouseHandled flag to true but, if the menu is displayed a second time, the mouseHandled flag does not get reset.  This results in the menu ignoring the .ui-menu-item click event in the second instance.</p><p><a href="http://jsfiddle.net/x9kfK/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/x9kfK/</a></p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 29, 2012 02:39AM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Minified - <a href="http://jsfiddle.net/tj_vantoll/9gGKW/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/tj_vantoll/9gGKW/.</a>  I can see the behavior you're referring to but it's only happening for me when the </p><pre class="wiki">menu</pre> is created in a <pre class="wiki">setTimeout</pre>.  Not exactly sure what's going on there.<p></p><p>If you're looking for a workaround don't use </p><pre class="wiki">setTimeout</pre>.  Or for a better approach don't destroy and recreate the <pre class="wiki">menu</pre> on every button click - <a href="http://jsfiddle.net/tj_vantoll/CGgB3/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/tj_vantoll/CGgB3/.</a><p></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 29, 2012 03:24AM UTC by <span class="author">MrBigDog2U</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It will happen with other events as well - for example, when the menu is created in response to an AJAX success callback.  This is the behavior that exposed the bug in the first place - my application requests data from the server and creates a menu with the information when the AJAX call returns.  It behaves the same when the menu is created in response to a keyboard event (see <a href="http://jsfiddle.net/R2u95/)." class="ext-link"><span class="icon"></span>http://jsfiddle.net/R2u95/).</a> Pretty much ANY event other than a mouse click.</p><p>As I explained in the initial description, this is due to errant handling of the mouseHandled flag in the ui.menu.  If the menu is created in response to a button click event, then the "onclick" handler resets the mouseHandled flag AFTER the menu is created (thus resetting the flag).  In response to ANY other event, the "onclick" handler either doesn't fire or fires before the menu gets created with the incorrect mouseHandled flag value.  The workaround I have implemented is to add a mouseHandled reset to the ui.menu _create method however I don't know if that approach will have side-effects in other parts of the widget.</p><p>I believe that I can use the approach of hiding and showing the menu like you demonstrated in your second jsfiddle link as a workaround that will not require changes to the jqueryui code.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 30, 2012 02:05AM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>summary:</th>
                  <td>
                    
                      <span class="change-field-old">JQuery UI menu select event not firing due to mouseHandled flag reset bug</span> → <span class="change-field-new">Menu: select event not firing due to mouseHandled flag reset bug</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 27, 2012 12:47PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The mouseHandled flag is global, not per instance, so destroying the menu during the select event prevents the document-click handler from resetting the flag. Based on the current code I can't tell why that flag is there, would've have to work through some git logs to figure that out.</p><p>For now, I see two options: Make the flag per instance, so an invalid stage in one menu doesn't affect any others. Or reset the flag on _destroy.</p><p>Both would address the issue at hand, though it would be preferable to figure out why the flag is there in the first place and just get rid of it. For now, what TJ suggests is a better solution, since reusing the menu makes a lot more sense.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 27, 2012 12:51PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Actually that was pretty easy to find: <a href="https://github.com/jquery/jquery-ui/commit/b8ad711deedab11da1f181b486ee67f259a3ef7c" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery-ui/commit/b8ad711deedab11da1f181b486ee67f259a3ef7c</a></p><p>Originally this was to remove the stopImmediatePropagation calls: <a href="https://github.com/jquery/jquery-ui/commit/26d6952bd2b81de2ad2adb0bb77c1be6f2d717c2" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery-ui/commit/26d6952bd2b81de2ad2adb0bb77c1be6f2d717c2</a></p><p>I tend to make that flag instance specific. I don't see why that needs to be shared across menu instances. Will ping Kris about it.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 28, 2012 03:20AM UTC by <span class="author">Kris Borchers</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Create mouseHandled flag per instance instead of globally. Fixes <a href="/ticket/8866">#8866</a> - Menu: select event not firing due to mouseHandled flag reset bug </p><p> Changeset: 5143b7f672bc668963cce7dcf5dd4e2970aad8e5</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
