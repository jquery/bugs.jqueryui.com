<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#15082 (jQuery Autocomplete Duplicate Remove event listener) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/15081/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/15083/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#15082</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened October 18, 2016 01:35PM UTC</p>
      
        <p>Closed April 19, 2017 04:54PM UTC</p>
      
      
        <p>Last modified September 12, 2017 07:43PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery Autocomplete Duplicate Remove event listener</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jGeek314
      </td>
      <th>Owned by:</th>
      <td>scottgonzalez</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.12.2">1.12.2</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.autocomplete</td>
      
        <th>Version:</th>
      
      <td>1.12.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>While trying to determine what was slowing down my autocomplete text box, I noticed that every time the user types in the target text box the number of event listeners would go up.  It looks like autocomplete (or the widget factory?) is adding duplicate "remove" events to the target. This can be reproduced by adding the following line to the default autocomplete example at <a href="https://jqueryui.com/autocomplete/" class="ext-link"><span class="icon"></span>https://jqueryui.com/autocomplete/</a> .</p><pre class="wiki">
response: function (e, ui) {
        console.log( jQuery._data( $("#tags")[0], "events" ) );
      }
</pre><p>When looking at the results in chrome's  tools I can see the number of event listeners go up every time the the user types in the target text box.</p><pre class="wiki">

Object {remove: Array[3], keydown: Array[1], keypress: Array[1], input: Array[1]...
Object {remove: Array[5], keydown: Array[1], keypress: Array[1], input: Array[1]...
Object {remove: Array[7], keydown: Array[1], keypress: Array[1], input: Array[1]...
Object {remove: Array[9], keydown: Array[1], keypress: Array[1], input: Array[1]...
</pre><p><a href="http://plnkr.co/edit/Jk2xg3ZjJ5jS5mgP1zHZ?p=preview" class="ext-link"><span class="icon"></span>http://plnkr.co/edit/Jk2xg3ZjJ5jS5mgP1zHZ?p=preview</a> is a demo of the remove events growing. </p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (10)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2016 12:58AM UTC by <span class="author">vladimir-i</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have also encountered a significant slowdown of autocomplete after upgrading from 1.11 to 1.12.</p><p>It gets worse the more you use it, eventually slowing to a crawl.</p><p>Here's a demo:  <a href="https://jsfiddle.net/Lm7xqs37/1/" class="ext-link"><span class="icon"></span>https://jsfiddle.net/Lm7xqs37/1/</a> </p><p>It's a copy of the default example but with more autocomplete options and with delay set to 0 to make it easier to see the slowdown. </p><p>To reproduce: enter and delete a letter (e.g. 's') a number of times and see how it gets slower and slower.</p><p>Chrome CPU profiler result:</p><pre class="wiki">
5725.9 ms88.63 %	6109.0 ms94.56 %	hasDuplicate	jquery-1.12.4.js:1340	
5724.9 ms88.62 %	6109.0 ms94.56 %	Sizzle.uniqueSort	jquery-1.12.4.js:1509	
5724.1 ms88.61 %	6108.2 ms94.55 %	add	jquery-1.12.4.js:3063	
5724.1 ms88.61 %	6108.2 ms94.55 %	_on	jquery-ui.js:573	
5724.1 ms88.61 %	6108.2 ms94.55 %	_classes	jquery-ui.js:503	
5724.1 ms88.61 %	6108.2 ms94.55 %	_toggleClass	jquery-ui.js:560	
3930.8 ms60.85 %	4198.2 ms64.99 %	_addClass	jquery-ui.js:556	
3930.8 ms60.85 %	4198.1 ms64.98 %	refresh	jquery-ui.js:5195	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	_suggest	jquery-ui.js:6092	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	__response	jquery-ui.js:6033	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	_superApply	jquery-ui.js:132	
3930.8 ms60.85 %	4198.1 ms64.98 %	__response	jquery-ui.js:6223	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:6021	
3930.8 ms60.85 %	4198.1 ms64.98 %	proxy	jquery-1.12.4.js:528	
3930.8 ms60.85 %	4198.1 ms64.98 %	source	jquery-ui.js:5951	
3930.8 ms60.85 %	4198.1 ms64.98 %	_search	jquery-ui.js:6010	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	search	jquery-ui.js:5993	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:136	
3930.8 ms60.85 %	4198.1 ms64.98 %	(anonymous function)	jquery-ui.js:5979	
3930.8 ms60.85 %	4198.1 ms64.98 %	handlerProxy)	query-ui.js:639
</pre><p>Chrome heap profiler shows that every time autocomplete search happens the old results div and li elements become a detached dom tree that can't get garbage collected. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2016 01:14AM UTC by <span class="author">vladimir-i</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks to jGeek314 for the workaround in <a href="https://bugs.jqueryui.com/ticket/10050#comment:6" class="ext-link"><span class="icon"></span>10050</a>, it works great:</p><pre class="wiki">
search: function(e,ui){
     //fix bug in jQuery.ui somewhere where menu.bindings just grows and grows
     autoComplete.data("ui-autocomplete").menu.bindings = $();
},
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 19, 2017 04:54PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ scottgonzalez</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In [changeset:"ef2e9bab92ae898311baa295590cd487d9071319" ef2e9ba]:</p><pre class="wiki">
#!CommitTicketReference repository="" revision="ef2e9bab92ae898311baa295590cd487d9071319"
Widget: Improve <code></code> event bindings for <code></code> options

Fixes #15078
Fixes #15082
Fixes #15095
Fixes #15136
Fixes #15152
Closes gh-1769
</pre>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 19, 2017 04:56PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">none</span> → <span class="change-field-new">1.12.2</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 03, 2017 01:24PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/15224">#15224</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 04, 2017 05:51AM UTC by <span class="author">ksurakka</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I think that this bug should not be closed, because the actual problem still exists. Before I wrote my (duplicate) bug report yesterday (thx for a quick response), I checked all open bugs but not the closed ones, which I think is a proper process.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 04, 2017 12:45PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">While trying to determine what was slowing down my autocomplete text box, I noticed that every time the user types in the target text box the number of event listeners would go up.  It looks like autocomplete (or the widget factory?) is adding duplicate &quot;remove&quot; events to the target. This can be reproduced by adding the following line to the default autocomplete example at https://jqueryui.com/autocomplete/ .&#92;
&#92;
&#92;
{{{&#92;
response: function (e, ui) {&#92;
        console.log( jQuery._data( $(&quot;#tags&quot;)[0], &quot;events&quot; ) );&#92;
      }&#92;
}}}&#92;
&#92;
When looking at the results in chrome&#39;s developer tools I can see the number of event listeners go up every time the the user types in the target text box.&#92;
&#92;
&#92;
{{{&#92;
&#92;
Object {remove: Array[3], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[5], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[7], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[9], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
}}}&#92;
&#92;
http://plnkr.co/edit/Jk2xg3ZjJ5jS5mgP1zHZ?p=preview is a demo of the remove events growing. &#92;
&#92;
&#92;
</span> → <span class="change-field-new">While trying to determine what was slowing down my autocomplete text box, I noticed that every time the user types in the target text box the number of event listeners would go up.  It looks like autocomplete (or the widget factory?) is adding duplicate &quot;remove&quot; events to the target. This can be reproduced by adding the following line to the default autocomplete example at https://jqueryui.com/autocomplete/ .&#92;
&#92;
&#92;
{{{&#92;
response: function (e, ui) {&#92;
        console.log( jQuery._data( $(&quot;#tags&quot;)[0], &quot;events&quot; ) );&#92;
      }&#92;
}}}&#92;
&#92;
When looking at the results in chrome&#39;s  tools I can see the number of event listeners go up every time the the user types in the target text box.&#92;
&#92;
&#92;
{{{&#92;
&#92;
Object {remove: Array[3], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[5], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[7], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
Object {remove: Array[9], keydown: Array[1], keypress: Array[1], input: Array[1]...&#92;
}}}&#92;
&#92;
http://plnkr.co/edit/Jk2xg3ZjJ5jS5mgP1zHZ?p=preview is a demo of the remove events growing. &#92;
&#92;
&#92;
</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The proper process could also include:</p><ul><li>Checking tickets that are closed with a future milestone (which would have found this ticket).</li><li>Testing against master to see if the bug still exists (which would have shown that it doesn't).</li></ul><p>Neither of these steps are necessary for a reporter to follow, but we are definitely following a proper process. It would not make sense to keep tickets open they are released; tickets are closed when they are fixed. This is how every project I've ever seen has worked.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 05, 2017 12:07PM UTC by <span class="author">ksurakka</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You are right, I should have checked those tickets as well and test against master, my bad. </p><p>It might be nice to see all open tickets and those that are already fixed but are targeted for a future version in a one list, I think it would be handy for developer. But as I said, my bad.</p><p>I did a new test against master version (<a href="https://jsfiddle.net/vm152La3/9/)," class="ext-link"><span class="icon"></span>https://jsfiddle.net/vm152La3/9/),</a> and it works much better but still seems to slowly slow down when using Chome. I added console.log (in a breakpoint) to line 1596 in query-3.2.1.js to print the size of the results array and it seems to grow by every time a popup is shown. In Safari it grows as well but does not cause notifiable slowness.</p><p>And thank you and all developers for your work. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 05, 2017 12:22PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jquery-ui-git seems to have been broken for a long time. You'll notice the header comment says "jQuery UI - v1.12.0-pre - 2016-02-09"</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 12, 2017 07:43PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/15237">#15237</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
