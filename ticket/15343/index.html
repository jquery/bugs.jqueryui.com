<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#15343 (References held to select and option elements after selectmenu(&amp;#39;destroy&amp;#39;) call) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/15342/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/15344/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#15343</a>
      <span class="ticket-status">new</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">()</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened May 28, 2019 11:02AM UTC</p>
      
      
        <p>Last modified May 28, 2019 11:02AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">References held to select and option elements after selectmenu(&#39;destroy&#39;) call</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        garycuthbert
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.selectmenu</td>
      
        <th>Version:</th>
      
      <td>1.12.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Following feedback from a question i posted on the forum:</p><p><a href="https://forum.jquery.com/topic/selectmenu-widget-correct-usage-of-destroy" class="ext-link"><span class="icon"></span>https://forum.jquery.com/topic/selectmenu-widget-correct-usage-of-destroy</a></p><p>I thought it would be worth raising this as a potential issue.</p><p>I am looking at memory usage in our web app and have been using the chrome developer memory tool (under windows 10) to take heap snapshots before and after certain actions. One such issue appears to be coming from the selectmenu widget. </p><p>I have created a codepen that shows the behaviour seen:</p><p><a href="https://codepen.io/garycuthbert/pen/dEjvyq" class="ext-link"><span class="icon"></span>https://codepen.io/garycuthbert/pen/dEjvyq</a></p><p>If you:</p><p>1. Run the codepen under chrome (i used incognito mode) and access the memory developer tools.</p><p>2. Collect the garbage (dustbin icon) and take an initial heap snapshot.</p><p>3. Click 'Create Combobox' and observe that a combo box is added to the output.</p><p>4. Click 'Remove <a href="/wiki/ComboBox">ComboBox</a>' and observe that the combo box is removed from the output.</p><p>5. Return to the memory tools and collect the garbage (you may need to wait a few seconds and click the icon a couple of times until the heap size stops reducing).</p><p>6. Take another heap snapshot.</p><p>7. Select the second snapshot, view the summary with 'Detached' in the view filter and select 'Objects allocated between Snapshot 1 and Snapshot 2'</p><p>8. Expand the 'Detached HTMLSelectElement' node and hover over the 'Detached' text of the sub item, you should see 'select.soloComboSelect'.</p><p>Screenshot:</p><p><a href="https://monosnap.com/file/4sHYv6pl6LTWQMMVfzalDILYazIHNE" class="ext-link"><span class="icon"></span>https://monosnap.com/file/4sHYv6pl6LTWQMMVfzalDILYazIHNE</a></p><p>I believe i am making the necessary calls to clear the DOM of the combobox but the heap comparison appears to suggest that the selectmenu widget is holding onto a reference to the select node.</p><p>In the codepen function 'destroyCombo' you can see that i explicitly clear the select node of options and call selectmenu('refresh') before calling selectmenu('destroy), without this extra step i see detached option elements that correspond to each of the 7 options added to the select node, screen shot:</p><p><a href="https://monosnap.com/file/CkztRik4XBuoNoanFJDhKtvFjEfPNK" class="ext-link"><span class="icon"></span>https://monosnap.com/file/CkztRik4XBuoNoanFJDhKtvFjEfPNK</a></p><p>Our app and the codepen both use v1.12.1 of jqueryui. Our app uses this with jquery v3.1.0 but the same behaviour is seen on the codepen using jquery v3.4.1.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (0)</summary>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
