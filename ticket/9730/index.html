<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9730 (when triggered drop and greedy = true, if DOM changed, drop event occurs again to others) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9729/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9731/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#9730</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(invalid)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened January 08, 2014 02:18AM UTC</p>
      
        <p>Closed January 25, 2014 09:01AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">when triggered drop and greedy = true, if DOM changed, drop event occurs again to others</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        trasyia
      </td>
      <th>Owned by:</th>
      <td>trasyia</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.droppable</td>
      
        <th>Version:</th>
      
      <td>1.10.3</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>This is because, </p><p>drop function calls each droppable and it's not stop until all loop is done.</p><p>When drop occurs actually, DOM can be changed and </p><p>this loop can detect another droppable object.</p><p>So, the loop must be stopped when greedy.</p><p>drop function is here,</p><pre class="wiki">
    drop: function(draggable, event) {

        var dropped = false;
        $.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function() {

            if(!this.options) {
                return;
            }
            if (!this.options.disabled && this.visible && $.ui.intersect(draggable, this, this.options.tolerance)) {
                dropped = this._drop.call(this, event) || dropped;
            }

            if (!this.options.disabled && this.visible && this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
                this.isout = true;
                this.isover = false;
                this._deactivate.call(this, event);
            }

        });
        return dropped;

    },
</pre><p>and solutions maybe...</p><pre class="wiki">
    drop: function(draggable, event) {

        var dropped = false;
        $.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function() {

            if(!this.options) {
                return;
            }
            if (!this.options.disabled && this.visible && $.ui.intersect(draggable, this, this.options.tolerance)) {
                dropped = this._drop.call(this, event) || dropped;
                if (dropped && this.options.greedy) return false;
            }

            if (!this.options.disabled && this.visible && this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
                this.isout = true;
                this.isover = false;
                this._deactivate.call(this, event);
            }

        });
        return dropped;

    }
</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (4)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 08, 2014 01:27PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ trasyia</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Please provide a reduced test case showing the problem. Also, as the red box says, please do not paste large blocks of code into tickets.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 10, 2014 01:07AM UTC by <span class="author">trasyia</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Ok, let&#39;s see the logical flow...&#92;
&#92;
&#39;drop&#39; works like this&#92;
{{{&#92;
foreach (droppable_dom)&#92;
{&#92;
    if (there is no child droppable_dom that is greedy and intersect) {&#92;
        do drop;&#92;
    }&#92;
}&#92;
}}}&#92;
&#92;
Let the DOM 1,2,3,4,5,6 is all &#39;greedy&#39; and &#39;pointer tolerance&#39; options, &#92;
and nested like [1   [2   [3   ] ] ] [4   [5   [6   ] ] ].&#92;
&#92;
When the DOM5 dropped to DOM3,&#92;
there is possibility, DOM2 or DOM4 get drop event,&#92;
because &#39;foreach&#39; loop run for all droppable DOM 1,2,3,4,5,6,&#92;
and after DOM5 dropped to DOM3, DOM size can be changed and DOM4 can interset to dropped point,&#92;
or (I don&#39;t know the reaseon) when &#39;foreach&#39; run for DOM2,&#92;
DOM3 is not detect when &#39;child droppable_dom&#39; check logic.&#92;
&#92;
So,&#92;
I suggest 2 way&#92;
&#92;
1. If dopped DOM is greedy, end foreach loop&#92;
2. Check all droppable DOM first, then do actual drop later.&#92;
</span> → <span class="change-field-new">1389316326012700</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Ok, let's see the logical flow...</p><p>'drop' works like this</p><pre class="wiki">
foreach (droppable_dom)
{
    if (there is no child droppable_dom that is greedy and intersect) {
        do drop;
    }
}
</pre><p>Let the DOM 1,2,3,4,5,6 is all 'greedy' and 'pointer tolerance' options, </p><p>and nested like [1   [2   [3   ] ] ] [4   [5   [6   ] ] ].</p><p>When the DOM5 dropped to DOM3,</p><p>there is possibility, DOM2 or DOM4 get drop event.</p><p>Because 'foreach' loop run for all droppable DOM 1,2,3,4,5,6,</p><p>and after DOM5 dropped to DOM3, DOM size can be changed and DOM4 can interset to dropped point.</p><p>Or, (I don't know the reaseon) when 'foreach' run for DOM2,</p><p>DOM3 is not detect as 'child droppable_dom'.</p><p>So,</p><p>I suggest 2 way</p><p>1. If dopped DOM is greedy, end foreach loop</p><p>2. Check all droppable DOM first, then do actual drop later.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 10, 2014 02:02PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 trasyia]:</p><blockquote> Ok, let's see the logical flow...  'drop' works like this <pre class="wiki">
&gt; foreach (droppable_dom)
&gt; {
&gt;     if (there is no child droppable_dom that is greedy and intersect) {
&gt;         do drop;
&gt;     }
&gt; }
&gt; </pre>  Let the DOM 1,2,3,4,5,6 is all 'greedy' and 'pointer tolerance' options,  and nested like [1   [2   [3   ] ] ] [4   [5   [6   ] ] ].  When the DOM5 dropped to DOM3, there is possibility, DOM2 or DOM4 get drop event.  Because 'foreach' loop run for all droppable DOM 1,2,3,4,5,6, and after DOM5 dropped to DOM3, DOM size can be changed and DOM4 can interset to dropped point.  Or, (I don't know the reaseon) when 'foreach' run for DOM2, DOM3 is not detect as 'child droppable_dom'.  So, I suggest 2 way  1. If dopped DOM is greedy, end foreach loop 2. Check all droppable DOM first, then do actual drop later.</blockquote><p>Hi trasyia,</p><p>Can you please provide a test case that shows this behavior in action? You can use this as a starting point: <a href="http://jsfiddle.net/tj_vantoll/8RtqV/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/tj_vantoll/8RtqV/.</a> I'm mostly wondering what specific DOM changes you are making in the </p><pre class="wiki">drop</pre> event such that it affects other droppables.<p></p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 25, 2014 09:01AM UTC by <span class="author">trac-o-bot</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Because we get so many tickets, we often need to return them to the initial reporter for more information. If that person does not reply within 14 days, the ticket will automatically be closed, and that has happened in this case. If you still are interested in pursuing this issue, feel free to add a comment with the requested information and we will be happy to reopen the ticket if it is still valid. Thanks!</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
