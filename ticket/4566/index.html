<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4566 (Including ui.datepicker.js causes a memory leak in IE6) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4565/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4567/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#4566</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened May 30, 2009 06:01PM UTC</p>
      
        <p>Closed October 17, 2012 04:30AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Including ui.datepicker.js causes a memory leak in IE6</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        ncj102
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.7.2">1.7.2</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.datepicker</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>ie6 memory leak datepicker</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I used IE 6.0.2800 on Windows 2000 SP1.</p><p>I am using the jQuery nightly build from May 28. I also included ui.core and ui.dialog at r2623.</p><p>To reproduce:</p><p>Create a page that does something simple, like:</p><p> </p><pre class="wiki">
	&lt;div id="box"&gt;hi&lt;/div&gt;
	&lt;script type="text/javascript" language="javascript"&gt;
	$(document).ready(function()
	{
		var dialog = $('#box').dialog();
	});
	&lt;/script&gt;
 </pre><p></p><p>Notice that the datepicker is not being used. Now browse to the page and away. In my case, I find 12 memory leaks (as reported in <a href="/ticket/4565">#4565</a>). Now add the script "ui.datepicker.js", but make no other changes. Browse to the page and away, again. You'll find that there is one more memory leak than there was without the datepicker library. In my case I find 13 leaks.</p><p>sIEve shows the additional leaking element as a div with the id "ui-datepicker-div".</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (13)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 01, 2009 03:32PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">TBD</span> → <span class="change-field-new">1.8</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 28, 2009 06:42AM UTC by <span class="author">kbwood</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>See also <a href="/ticket/4644">#4644</a> - in 1.7.2.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 19, 2009 12:31PM UTC by <span class="author">GazQuest</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In my jQuery UI tests I have been experiencing memory leaks in IE 7 caused by the repeated use of filter: in the theme css which is used to apply a transparent overlay on modal dialogs or to create shadow effects such as :</p><pre class="wiki">
.ui-datepicker-cover { ... filter: mask(); /*must have*/}
.ui-widget-overlay { ... filter:Alpha(Opacity=30);}
.ui-widget-shadow { ... filter:Alpha(Opacity=30);}
</pre><p>IE has a known bug where filter: will claim memory each time it is used. The memory is only released when the page is navigated away from or refreshed which is a big problem for single-page dynamic ajax applications</p><p>There is a workaround for this which stops the memory leak; edit the theme's css file and remove all filter: rules. In the case of the .ui-widget-overlay rule, which dims the background page during a modal dialog, I replaced the filter: with this :</p><pre class="wiki">
background: transparent url(images/GridLattice.gif) top left repeat;
</pre><p>The grid lattice gif is just a gif with alternative coloured pixels and transparent pixels. It's ugly but does the job without memory leaks.</p><p>I checked out extJS which uses filter: in the same way for modal dialogs but it doesn't suffer from increasing memory leaks. This is because the overlay div is always present so filter: is only instantiated once. You do get a memory hit on the first dialog but no more leaks after that because the same filter: element is used for all subsequent modal dialogs.</p><p>I suspect that jQuery UI creates new dom elements each time it needs a filter: which explains why the memory usage rises continuously on the same page with use.</p><p>A possible fix would be to do what extJS does and leave a filter: dom element ever present on the screen and just show/hide as necessary, this would work for modal dialogs at least.</p><p>For now I'm happy with the grid lattice gif fix and it's a relief to see memory usage stable when I open new dialogs as it was making me wonder if jQuery UI is ready for the kind of app I'm writing. I'd already had to rule out extJS because it is too slow on the typical target machines my users will be using, and I was running out of options other than self-build!</p><p>I don't know if this has been reported before but if not then it could explain some of the other IE memory leaks that have been reported. All it takes is a filter:</p><p>Gaz</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 19, 2009 04:23PM UTC by <span class="author">GazQuest</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Nope I take half of that back. The above works if you keep the same modal dialog open and keep re-opening it. But for every new dialog I open I get a 200k hit that is never released. This has nothing to do with filter:. I destroy everything to do with the dialog</p><p>I've come up with a workaround which is to have a pool of divs that are specifically for dialogs. I have an array of [false, false, false etc...] to start with which means none of the div are dialogs yet. When I request a dialog I check if there are any uninitialized divs and dialog( oConfig) them. If there are no uninitialized divs then I check each dialog( 'isOpen') == false and use closed dialogs with the new dialog</p><p>If there are no divs left I can either say "Too many windows open" or dynamically add another to the pool of dialog divs. Seems to work ok in my preliminary testing but I've yet to test with dynamic data being added to the dialogs</p><p>You get a memory hit for each dialog but at least it is capped to how many dialog divs I have. So effectively it looks like you need a dialog manager to work with multiple dialogs in a long-life single-page app otherwise you get memory leaks</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 25, 2009 12:07PM UTC by <span class="author">tebulin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/wiki/GazQuest">GazQuest</a> notes that the issue originates from a used CSS themen with IE filter statements.</p><p>I just wanted to note that this does not seem the soley problem, as we expierience still heavy leaks in IE even after removing all of them. </p><p>So besides the depicted filter issue, further leaks seem to exist.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 24, 2009 02:48AM UTC by <span class="author">asoft</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>For those waiting on the IE6 + Memory leak fix, from what I can tell it can be drastically reduced / eliminated by adding in the following lines (based on full ui.datepicker.js v1.7.2) to the end of function "_destroyDatepicker":</p><p>$target.unbind('setData.setData.datepicker').unbind('getData.setData.datepicker');</p><p>this._lastInput = null;</p><p>The first line should fix the issue where simply 'including' the datepicker results in a memory increase. This is due to (for whatever reason) the anonymously bound functions not being 'unbound'.</p><p>The second line removes a circular reference (if applicable) that occurs due to datepickers internal workings.</p><p>Both lines are not a standalone fix. You need to make sure in whatever script is instantiating the datepickers that it will also 'destroy' them when they are no longer needed:</p><p>$(window).unload(function() {</p><p>  $('&lt;your date picker element selector(s) here&gt;').datepicker('destroy');</p><p>});</p><p>*note: would have posted on SO but didn't have an openid account. might get around to it. eventually...</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 24, 2009 02:57AM UTC by <span class="author">asoft</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:8 asoft]:</p><blockquote> $target.unbind('setData.setData.datepicker').unbind('getData.setData.datepicker');</blockquote><p>proof reading fail. that should be:</p><p>$target.unbind('setData.datepicker').unbind('getData.datepicker');</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 26, 2010 05:27PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Also see <a href="/ticket/4906">#4906</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 06, 2011 01:49PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/7450">#7450</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 14, 2011 03:08PM UTC by <span class="author">inspiraller</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, this is hilarious. I have been trying to figure out why using jquery ui dialog suddenly causes IE to go from 20kb to 350kb of memory. The reason is the css. Using @ symbols truly F**** IE. Also, if you have a lot of css, it screws it up too. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 18, 2011 02:37PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/7802">#7802</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 11, 2012 02:43PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.9.0</span> → <span class="change-field-new">1.11.0</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 17, 2012 04:30AM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.11.0</span> → <span class="change-field-new">1.7.2</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jQuery UI stopped using @ symbols in css in 1.7.2 Please feel free to file a new bug if you still believe there's a memory leak.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
