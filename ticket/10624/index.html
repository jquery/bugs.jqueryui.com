<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10624 (Position: alignments passed to &amp;quot;using&amp;quot; handler are unreliable) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10623/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10625/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#10624</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened September 26, 2014 10:19AM UTC</p>
      
        <p>Closed March 18, 2015 01:15AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Position: alignments passed to &quot;using&quot; handler are unreliable</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        r.otten
      </td>
      <th>Owned by:</th>
      <td>r.otten</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.position</td>
      
        <th>Version:</th>
      
      <td>1.11.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Currently the logic that sets the horizontal and vertical alignment passed to a ''using'' handler function is as follows:</p><pre class="wiki">
horizontal: right &lt; 0 ? "left" : left &gt; 0 ? "right" : "center"
vertical: bottom &lt; 0 ? "top" : top &gt; 0 ? "bottom" : "middle"
</pre><p><a href="https://github.com/jquery/jquery-ui/blob/9bb51d308e0a72bc67db948e92345c826a8f724d/ui/position.js#L293-L294" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery-ui/blob/9bb51d308e0a72bc67db948e92345c826a8f724d/ui/position.js#L293-L294</a></p><p>This is susceptible to rounding errors or errors related to numeric stability in browsers that report sub-pixel offsets and/or widths. In these browsers it may occur that the ''left'', ''right'', ''top'' or ''bottom'' values deviate from 0 by a minute sub-pixel value, leading to selection of the wrong aligment.</p><p>E.g.</p><p>When ''right'' is -0.1 and ''left'' is 200, then ''horizontal'' will be set to "left" while it should be set to "right".</p><p>I suggest either applying rounding or widening the tolerance of the comparisons to half a pixel, i.e. :</p><pre class="wiki">
horizontal: right &lt;= .5 ? "left" : left &gt;= .5 ? "right" : "center",
vertical: bottom &lt;= .5 ? "top" : top &gt;= .5 ? "bottom" : "middle"
</pre><p>That should avert the problem.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2014 01:36PM UTC by <span class="author">tj.vantoll</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ r.otten</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi r.otten,</p><p>Thanks for taking the time to contribute to jQuery UI. Do you have a specific situation that actually replicates this problem? You can use this test case as a starting point: <a href="http://jsfiddle.net/tj_vantoll/KTzQV/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/tj_vantoll/KTzQV/</a></p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 27, 2014 12:30PM UTC by <span class="author">r.otten</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Hi,&#92;
&#92;
I found a reproduction; http://jsfiddle.net/KTzQV/12/&#92;
Works (or rather; fails) atleast in Firefox 32, where it reports a &quot;center&quot; alignment, rather than the expected &quot;right&quot; alignment.&#92;
&#92;
Note that it is &#39;&#39;very&#39;&#39; hard to predictably trigger a problem with numerical stability in floating point numbers, so I&#39;m making thankful use of another bug here to induce a rounding error. That bug being the fact that jQuery UI gets its support test for offset fractions wrong when executed after a document has already loaded its body element; hence the $.ajax call for the script.&#92;
&#92;
Once that bug becomes patched, I expect this issue to occur a lot less frequent. (But it will still occur at times. That&#39;s floating point for you...)&#92;
&#92;
</span> → <span class="change-field-new">1411821165375401</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>I found a reproduction; <a href="http://jsfiddle.net/KTzQV/12/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KTzQV/12/</a> </p><p>The issue reproduces atleast in Firefox 32, where it reports a "center" alignment, rather than the expected "right" alignment.</p><p>Note that it is ''very'' hard to predictably trigger a problem with numerical stability in floating point numbers, so I'm making thankful use of another bug here to induce a rounding error. That bug being the fact that jQuery UI gets its support test for offset fractions wrong when executed after a document has already loaded its body element; hence the $.ajax call for the script.</p><p>Once that bug becomes patched, I expect this issue to occur a lot less frequent. (But it will still occur at times. That's floating point for you...)</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 29, 2014 05:44PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">git</span> → <span class="change-field-new">1.11.1</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Using that fiddle, I don't see any difference by accounting for a 0.5px margin of error: <a href="http://jsfiddle.net/KTzQV/13/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KTzQV/13/</a> In fact, the values I'm getting show that <code>right</code> is already negative (though negative by less than 0.5).</p><p>Anyway, I'm not sure that being off by one pixel is going to make much of a difference here since the value can changed based on the width of the element being positioned anyway. <a href="http://view.jqueryui.com/master/tests/visual/position/position_feedback.html" class="ext-link"><span class="icon"></span>http://view.jqueryui.com/master/tests/visual/position/position_feedback.html</a> shows the values at every possible placement, it's just not possible to have a generic value be perfect in all cases.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2014 11:31AM UTC by <span class="author">r.otten</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">You&#39;re right; comparing against a 0.5px value does not work.&#92;
A different approach, however, does:&#92;
&#92;
{{{&#92;
if (( 1 &gt; abs( left )) &amp;&amp; ( 1 &gt; abs( right ))) {&#92;
  feedback.horizontal = &quot;center&quot;;&#92;
} else if (( right &lt;= -1 ) &amp;&amp; ( left &gt;= 1 )) {&#92;
  feedback.horizontal = &quot;center&quot;;&#92;
} else if ( 1 &gt; abs( left ) || ( right &lt;= -1 )) {&#92;
  feedback.horizontal = &quot;left&quot;;&#92;
} else if ( 1 &gt; abs( right ) || ( left &gt;= 1 )) {&#92;
  feedback.horizontal = &quot;right&quot;;&#92;
} else {&#92;
  feedback.horizontal = &quot;center&quot;;&#92;
}&#92;
&#92;
if (( 1 &gt; abs( top )) &amp;&amp; ( 1 &gt; abs( bottom ))) {&#92;
  feedback.vertical = &quot;middle&quot;;&#92;
} else if (( bottom &lt;= -1 ) &amp;&amp; ( top &gt;= 1 )) {&#92;
  feedback.vertical = &quot;middle&quot;;&#92;
} else if ( 1 &gt; abs( top ) || ( bottom &lt;= -1 )) {&#92;
  feedback.vertical = &quot;top&quot;;&#92;
} else if ( 1 &gt; abs( bottom ) || ( top &gt;= 1 )) {&#92;
  feedback.vertical = &quot;bottom&quot;;&#92;
} else {&#92;
  feedback.vertical = &quot;middle&quot;;&#92;
}&#92;
}}}&#92;
&#92;
&#92;
The lines that follow, namely:&#92;
&#92;
{{{&#92;
if ( targetWidth &lt; elemWidth &amp;&amp; abs( left + right ) &lt; targetWidth ) {&#92;
  feedback.horizontal = &quot;center&quot;;&#92;
}&#92;
if ( targetHeight &lt; elemHeight &amp;&amp; abs( top + bottom ) &lt; targetHeight ) {&#92;
  feedback.vertical = &quot;middle&quot;;&#92;
}&#92;
}}}&#92;
&#92;
also have to be removed, as they are also subject to use of subpixel values and floating point rounding errors. However, with the above change to check for aligned edges, they are also no longer needed.&#92;
&#92;
See http://jsfiddle.net/KTzQV/17/ for the problem no longer occuring in the reduced reproduction&#92;
and http://jsfiddle.net/xh6uq2rg/4/ for the visual position test using the updated logic.&#92;
&#92;
&#92;
(NOTE: I&#39;m still working on reducing the number of comparisons.)</span> → <span class="change-field-new">1413203437250935</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>You're right; comparing against a 0.5px value does not work.</p><p>A different approach, however, does:</p><pre class="wiki">
if (( 1 &gt; abs( left )) && ( 1 &gt; abs( right ))) {
  feedback.horizontal = "center";
} else if (( right &lt;= -1 ) && ( left &gt;= 1 )) {
  feedback.horizontal = "center";
} else if ( 1 &gt; abs( left ) || ( right &lt;= -1 )) {
  feedback.horizontal = "left";
} else if ( 1 &gt; abs( right ) || ( left &gt;= 1 )) {
  feedback.horizontal = "right";
} else {
  feedback.horizontal = "center";
}

if (( 1 &gt; abs( top )) && ( 1 &gt; abs( bottom ))) {
  feedback.vertical = "middle";
} else if (( bottom &lt;= -1 ) && ( top &gt;= 1 )) {
  feedback.vertical = "middle";
} else if ( 1 &gt; abs( top ) || ( bottom &lt;= -1 )) {
  feedback.vertical = "top";
} else if ( 1 &gt; abs( bottom ) || ( top &gt;= 1 )) {
  feedback.vertical = "bottom";
} else {
  feedback.vertical = "middle";
}
</pre><p>The lines that follow, namely:</p><pre class="wiki">
if ( targetWidth &lt; elemWidth && abs( left + right ) &lt; targetWidth ) {
  feedback.horizontal = "center";
}
if ( targetHeight &lt; elemHeight && abs( top + bottom ) &lt; targetHeight ) {
  feedback.vertical = "middle";
}
</pre><p>also have to be removed, as they are also subject to use of subpixel values and floating point rounding errors. However, with the above change to check for aligned edges, they are also no longer needed.</p><p>See <a href="http://jsfiddle.net/KTzQV/17/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KTzQV/17/</a> for the problem no longer occuring in the reduced reproduction</p><p>and <a href="http://jsfiddle.net/xh6uq2rg/4/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/xh6uq2rg/4/</a> for the visual position test using the updated logic.</p><p>(NOTE: I'm still working on reducing the number of comparisons.)</p><p>[EDIT]</p><p>Managed to reduce the number of cases and factored out a few common computations.</p><p>See updated fiddle <a href="http://jsfiddle.net/xh6uq2rg/8/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/xh6uq2rg/8/</a></p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 14, 2014 01:36PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Please just provide a pull request. Pasting large blocks of code into tickets makes it very difficult to track changes and have discussions.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 18, 2015 01:15AM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I still don't think that this is a legitimate bug. As mentioned earlier, the generic feedback positions can never be optimized, that's why the exact numeric values are provided as well.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
