<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4918 (undefined error because of UI&amp;#39;s droppable) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4917/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4919/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#4918</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened October 19, 2009 08:30AM UTC</p>
      
        <p>Closed October 21, 2009 01:12PM UTC</p>
      
      
        <p>Last modified October 11, 2012 09:15PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">undefined error because of UI&#39;s droppable</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        nicolas
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        critical
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/"></a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.core</td>
      
        <th>Version:</th>
      
      <td>1.7.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hi,</p><p>we are currently having somewhat of a big issue when using UI's draggable and droppable features.</p><p>We have DIV's on the page that are .resizable() and .draggable(). This has always worked fine (we are able to move and resize all DIV's on the page).</p><p>Lately, we have added to some of those DIV's the .droppable() feature. Since then, bugs happen. </p><p>At initial load, everything is fine. It is possible to move and resize all DIV's, and those having the droppable() property are effectively used as drop-zones (in addition to being resizable and draggable). </p><p>After a postback, in which we alter the control tree and do some heavy AJAX duty, when trying to move a DIV that has the droppable() property, we get an unspecified error on the following line of code: </p><p>var G=this[0].getBoundingClientRect()</p><p>That is located in jquery-1.3.2.js, under the Sizzle CSS Selector Engine.</p><p>We tried going back to jquery-1.6.2.js, and in that case, we get the unspecified error on another line:</p><p>offsetParent = elem.offsetParent</p><p>The error only happens after some AJAX is done, and only when trying to drag a DIV that has the droppable() property set. Trying to move any other DIV will not cause any error. Pushing F5 after we got the error, and then after trying to move a DIV that is set as droppable(), will not cause any error until heavy AJAX happens again.</p><p>There is something I have noticed, not sure if this can help, but this proves something is wrong somewhere in the CSS. When doing the AJAX thing that then causes the error to happen, I notice a CSS change on the DIV's that are set as droppable. The difference appears to be some transparency issue. See an example here:</p><p>before AJAX: <a href="http://img8.imageshack.us/i/beforelg.png/" class="ext-link"><span class="icon"></span>http://img8.imageshack.us/i/beforelg.png/</a> </p><p>after AJAX: <a href="http://img42.imageshack.us/i/afterd.png/" class="ext-link"><span class="icon"></span>http://img42.imageshack.us/i/afterd.png/</a></p><p>Look at the right and bottom sides of the chart. Please note though, that this also happens when the droppable() is not set (thus no error happens at all), so it may totally unrelated. Also, this is not very important and does not require an immediate fix - I'm just showing this in case it may has something to do with our issue.</p><p>I have done some research and found that other people have similar problems, although it did not help us find a solution:</p><p><a href="http://weblogs.asp.net/rajbk/archive/2006/11/29/ie-6-7-unspecified-error-when-accessing-offsetparent-javascript.aspx" class="ext-link"><span class="icon"></span>http://weblogs.asp.net/rajbk/archive/2006/11/29/ie-6-7-unspecified-error-when-accessing-offsetparent-javascript.aspx</a></p><p><a href="http://www.nabble.com/jQuery-offsetParent---using-with-drag-drop-UI-problem-in-IE7-td21871703s27240.html" class="ext-link"><span class="icon"></span>http://www.nabble.com/jQuery-offsetParent---using-with-drag-drop-UI-problem-in-IE7-td21871703s27240.html</a></p><p>We are using IE8 (same behavior with IE8 and IE7 compatibility view) with Vista x64.</p><p>Unfortunately, the application is really complex and AJAX heavy, so it is near to impossible to create a sample project reproducing the issue.</p><p>It also won't run in Firefox or anything else than IE (8, for that matter).</p><p>Any help is appreciated.</p><p>Thanks,</p><p>Nicolas</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (7)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2009 09:10AM UTC by <span class="author">nicolas</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>this was fixed thanks to using this code, apparently redefining the offset function to make it work under IE:</p><pre class="wiki">


// Originally By Brandon Aaron, part of the Dimension Plugin
// http://jquery.com/plugins/project/dimensions
jQuery.fn.offset = function() {
    ///     &lt;summary&gt;
    ///             Gets the current offset of the first matched element relative to the viewport.
    ///     &lt;/summary&gt;
    ///     &lt;returns type="Object"&gt;An object with two Integer properties, 'top' and 'left'.&lt;/returns&gt;

    var left = 0, top = 0, elem = this[0], results;

    if (elem) with (jQuery.browser) {
        var parent = elem.parentNode,
                offsetChild = elem,
                offsetParent = IESafeOffsetParent(elem),
                doc = elem.ownerDocument,
                safari2 = safari && parseInt(version) &lt; 522 && !/adobeair/i.test(userAgent),
                css = jQuery.curCSS,
                fixed = css(elem, "position") == "fixed";

        // Use getBoundingClientRect if available
        if (false && elem.getBoundingClientRect) {
            var box = elem.getBoundingClientRect();

            // Add the document scroll offsets
            add(box.left + Math.max(doc.documentElement.scrollLeft, doc.body.scrollLeft),
                        box.top + Math.max(doc.documentElement.scrollTop, doc.body.scrollTop));

            // IE adds the HTML element's border, by default it is medium which is 2px
            // IE 6 and 7 quirks mode the border width is overwritable by the following css html { border: 0; }
            // IE 7 standards mode, the border is always 2px
            // This border/offset is typically represented by the clientLeft and clientTop properties
            // However, in IE6 and 7 quirks mode the clientLeft and clientTop properties are not updated when overwriting it via CSS
            // Therefore this method will be off by 2px in IE while in quirksmode
            add(-doc.documentElement.clientLeft, -doc.documentElement.clientTop);

            // Otherwise loop through the offsetParents and parentNodes
        } else {

            // Initial element offsets
            add(elem.offsetLeft, elem.offsetTop);

            // Get parent offsets
            while (offsetParent) {
                // Add offsetParent offsets
                add(offsetParent.offsetLeft, offsetParent.offsetTop);

                // Mozilla and Safari &gt; 2 does not include the border on offset parents
                // However Mozilla adds the border for table or table cells
                if (mozilla && !/^t(able|d|h)$/i.test(offsetParent.tagName) || safari && !safari2)
                    border(offsetParent);

                // Add the document scroll offsets if position is fixed on any offsetParent
                if (!fixed && css(offsetParent, "position") == "fixed")
                    fixed = true;

                // Set offsetChild to previous offsetParent unless it is the body element
                offsetChild = /^body$/i.test(offsetParent.tagName) ? offsetChild : offsetParent;
                // Get next offsetParent
                offsetParent = offsetParent.offsetParent;
            }

            // Get parent scroll offsets
            while (parent && parent.tagName && !/^body|html$/i.test(parent.tagName)) {
                // Remove parent scroll UNLESS that parent is inline or a table to work around Opera inline/table scrollLeft/Top bug
                if (!/^inline|table.*$/i.test(css(parent, "display")))
                // Subtract parent scroll offsets
                    add(-parent.scrollLeft, -parent.scrollTop);

                // Mozilla does not add the border for a parent that has overflow != visible
                if (mozilla && css(parent, "overflow") != "visible")
                    border(parent);

                // Get next parent
                parent = parent.parentNode;
            }

            // Safari &lt;= 2 doubles body offsets with a fixed position element/offsetParent or absolutely positioned offsetChild
            // Mozilla doubles body offsets with a non-absolutely positioned offsetChild
            if ((safari2 && (fixed || css(offsetChild, "position") == "absolute")) ||
                        (mozilla && css(offsetChild, "position") != "absolute"))
                add(-doc.body.offsetLeft, -doc.body.offsetTop);

            // Add the document scroll offsets if position is fixed
            if (fixed)
                add(Math.max(doc.documentElement.scrollLeft, doc.body.scrollLeft),
                                Math.max(doc.documentElement.scrollTop, doc.body.scrollTop));
        }

        // Return an object with top and left properties
        results = { top: top, left: left };
    }

    function border(elem) {
        ///     &lt;summary&gt;
        ///             This method is internal.
        ///     &lt;/summary&gt;
        ///     &lt;private /&gt;
        add(jQuery.curCSS(elem, "borderLeftWidth", true), jQuery.curCSS(elem, "borderTopWidth", true));
    }

    function add(l, t) {
        ///     &lt;summary&gt;
        ///             This method is internal.
        ///     &lt;/summary&gt;
        ///     &lt;private /&gt;
        left += parseInt(l, 10) || 0;
        top += parseInt(t, 10) || 0;
    }

    return results;
};

function IESafeOffsetParent(elem) {
    try {
        return elem.offsetParent;
    }
    catch (e) {
        return document.body;
    }
}
</pre><p>Any chance you can fix that in a future release of jQuery so that we can get rid of that fix?</p><p>Thanks</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 21, 2009 01:12PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Bugs in .offset() belong in <a href="http://dev.jquery.com" class="ext-link"><span class="icon"></span>jQuery's bug tracker</a>.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 12, 2009 09:37AM UTC by <span class="author">Sensor</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>what is this fix? HELP!!!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 12, 2009 09:37AM UTC by <span class="author">Sensor</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:3 Sensor]:</p><blockquote> Could you please tell me how to patch this this fix? HELP!!!</blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 12, 2009 09:37AM UTC by <span class="author">Sensor</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:4 Sensor]:</p><blockquote> Replying to [comment:3 Sensor]: &gt; Could you please tell me how to patch this fix? HELP!!!</blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 17, 2009 02:09AM UTC by <span class="author">ckosti</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have the same issue. An ASP.NET AJAX call replaces #dropContainer, but $.ui.ddmanager.droppables.default continues to hold on to the old instances of #dropContainer. So after two calls back to the server, I end up with three instances of #dropContainer in $.ui.ddmanager.droppables.default, only one of which actually exists in the document tree.</p><p>Then when a drag starts, prepareOffsets() gets called, which results in getBoundingClientRect() being called against elements that have no parent element. In IE, this causes an error.</p><p>It seems unlikely to me that $.ui.ddmanager was intended to hold onto dead elements. In that case, I think this indicates that there are bugs in both libraries. The corresponding ticket for JQuery's .offset() issue is here for anyone who is interested: <a href="http://dev.jquery.com/ticket/4996" class="ext-link"><span class="icon"></span>http://dev.jquery.com/ticket/4996</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 11, 2012 09:15PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">TBD</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Milestone TBD deleted</p>
            </div>
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
