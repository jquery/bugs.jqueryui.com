<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13024 (draggable with connectToSortable not compatible with clone helper) - jQuery UI - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/u10aUuj4Q4.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13022/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13028/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h2>
      <a href="" class="ticket-number">#13024</a>
      <span class="ticket-status">new</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">()</span>
    </h2>

    <div class="ticket-dates">
      <p>Opened June 05, 2015 12:54PM UTC</p>
      
      
        <p>Last modified September 29, 2016 10:31AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">draggable with connectToSortable not compatible with clone helper</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        esion
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/none">none</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ui.sortable</td>
      
        <th>Version:</th>
      
      <td>1.11.4</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The dragged item is not removed from DOM when sortable use helper clone</p><p>how to reproduce : <a href="http://plnkr.co/edit/Bc98fE0yAgf3aQtJDmep?p=preview" class="ext-link"><span class="icon"></span>http://plnkr.co/edit/Bc98fE0yAgf3aQtJDmep?p=preview</a></p><p>1. Move an item from 3rd list (draggable) to any position</p><p>2. move an item from 1rst list to the second one </p><blockquote> the old item is frozen in front at the place it was dropped</blockquote><p>''Note: 1rst & 2 nd list are sortables but I also see it on a droppable''</p><p>the config used in plnkr : </p><pre class="wiki">
$(function() {
  $( "#sortable1, #sortable2" ).sortable({
    connectWith: ".connected",
    helper: "clone",
  }).disableSelection();
  
  $("#clonnable1 li").draggable({
    connectToSortable: "#sortable1, #sortable2"
  }).disableSelection();
});
</pre><p>This is due to : sortable.cancelHelperRemoval = true in "stop" callback : <a href="https://github.com/jquery/jquery-ui/blob/1.11.4/ui/draggable.js#L762" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery-ui/blob/1.11.4/ui/draggable.js#L762</a></p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (4)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 05, 2015 01:05PM UTC by <span class="author">esion</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>eventually a screenshot </p><p>[[Image(<a href="https://drive.google.com/file/d/0BzN06uJT7FrLSnRzX1JHUXhYems/view)" class="ext-link"><span class="icon"></span>https://drive.google.com/file/d/0BzN06uJT7FrLSnRzX1JHUXhYems/view)</a>]]</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 16, 2015 08:44PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">ui.core</span> → <span class="change-field-new">ui.sortable</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 07, 2015 09:18AM UTC by <span class="author">jcano</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Is there any progress on this? I can confirm this is happening:</p><p><a href="http://jsfiddle.net/jcano/nqk15c02/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/jcano/nqk15c02/</a></p><p>Same steps to reproduce:</p><p>1. Drag from the first list (draggable) to any of the sortables</p><p>2. Drag from the other sortable to the first sortable.</p><p>The helper is not removed, it stays visible at the last position before releasing the mouse button. This is due to how draggable manages dropping on a connected sortable. It sets the variable </p><pre class="wiki">cancelHelperRemoval</pre> to true on the sortable but never returns the value to false, so the sortable from that point on will never remove helpers.<p></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 29, 2016 10:31AM UTC by <span class="author">matt-hoskins</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This bug is still present in 1.12.1 - I've just hit this same bug myself. I've updated the jsfiddle from jcano to reference 1.12.1:</p><p><a href="http://jsfiddle.net/nqk15c02/3/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/nqk15c02/3/</a></p><p>The cause is still the same.</p><p>The issue was introduced in 1.11.2 as a side effect of this commit:</p><p><a href="https://github.com/jquery/jquery-ui/commit/1cc380778b99c87acc82f363f6376d11d4d3759a" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery-ui/commit/1cc380778b99c87acc82f363f6376d11d4d3759a</a></p><p>However I don't understand what this setting "this.instance.cancelHelperRemoval = true" is actually achieving (other than introducing this bug). This particular piece of code is called in cases where "sortable.isOver" is not true - which I presume means that the draggable isn't within this connected sortable at this point? In which case even if this draggable had entered that sortable at some point, it must have exited it already and thus connectToSortable's drag event would have already called _mouseStop on the sortable (and _mouseStop is the only place for sortable where cancelHelperRemoval on the sortable is used). The next line after setting this.instance.cancelHelperRemoval = true is to trigger "deactivate" on the sortable which, as far as I can tell, doesn't result in a call on _mouseStop (and _mouseStop won't be called on that sortable because isOver is not true).</p><p>The comment in the code says "Prevent this Sortable from removing the helper" - as per my reading of the code noted above I don't believe a sortable with isOver not being true will remove the helper because it's not due to have _mouseStop called by this point.</p><p>I believe that cancelHelperRemoval on the sortable is purely for use by connectToSortable's drag, when the draggable is dragged out of a sortable, to signal to that sortable's _mouseStop code that it shouldn't remove the helper (because the drag is still in progress of course). I think the code in connectToSortable's ".stop" to set cancelHelperRemoval is purely to clean up any cancelHelperRemoval values left to true. What should probably happen really is that after connecToSortable's ".drag" calls sortable._mouseStop it should then revert sortable.cancelHelperRemoval back to false to clean up after itself as, as far as I can tell, it doesn't need to be left set to true. If ".drag" did reset cancelHelperRemoval back to false then ".stop" for connectToSortable doesn't need to touch cancelHelperRemoval at all on the sortables - if sortable.isOver is true then the current code allows the sortable to do the helper removal so it can be left as false, and on ones where isOver is false then _mouseStop isn't going to be called on them so they're not going to try remove the helper anyway.</p><p>Of course I'm no expert in jqueryui code, this is just me trying to piece together what happens, so maybe I've made a mistake :).</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
