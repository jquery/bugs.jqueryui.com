<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">TracFineGrainedPermissions</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/yIpytWuWSz.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="wiki flex-column">
  <div class="breadcrumbs-nav flex-row">
    <a href="/" class="breadcrumbs-nav-first">wiki:</a>
    
      <a href="/wiki/TracFineGrainedPermissions/">TracFineGrainedPermissions</a>
    
  </div>
  <nav class="content-nav">
    <ul class="flex-row">
      <li>
        <a href="/">Start Page</a>
      </li>
      <li>
        <a href="/wiki/TitleIndex">Index</a>
      </li>
    </ul>
  </nav>
  <div class="wiki-content">
    
<h1>Fine grained permissions</h1><p>There is a general mechanism in place that allows custom **permission policies** to grant or deny any action on any Trac resource, or even specific versions of a resource.</p><p>That mechanism is <code>authz_policy</code>, which is an optional module in <code>tracopt.perm.authz_policy.*</code>, so it is installed by default. It can be activated via the <em>Plugins</em> panel in the Trac administration module.</p><h2>Permission Policies</h2><p>A great diversity of permission policies can be implemented and Trac comes with a few examples. </p><p>The active policies are determined by a [TracIni#trac-permission_policies-option configuration setting]:</p><pre class="wiki">[trac]
permission_policies = ReadonlyWikiPolicy, DefaultPermissionPolicy, LegacyAttachmentPolicy
</pre><ul><li><a href="#ReadonlyWikiPolicy" class="ext-link"><span class="icon"></span>#ReadonlyWikiPolicy</a> controls readonly access to wiki pages.</li><li>DefaultPermissionPolicy checks for the traditional coarse-grained permissions described in <a href="/wiki/TracPermissions">TracPermissions</a>.</li><li>LegacyAttachmentPolicy uses the coarse-grained permissions to check permissions on attachments.</li></ul><p>Among the optional choices, there is <a href="#AuthzPolicy" class="ext-link"><span class="icon"></span>#AuthzPolicy</a>, a very generic permission policy, based on an Authz-style system. See</p><p><a href="https://trac.edgewall.org/intertrac/source:branches/1.2-stable/tracopt/perm/authz_policy.py" class="ext-link"><span class="icon"></span>authz_policy.py</a> for details. </p><p>Another permission policy <a href="#AuthzSourcePolicy" class="ext-link"><span class="icon"></span>#AuthzSourcePolicy</a>, uses the <a href="http://svnbook.red-bean.com/nightly/en/svn.serverconfig.pathbasedauthz.html" class="ext-link"><span class="icon"></span>path-based authorization</a> defined by Subversion to enforce permissions on the version control system.</p><p>See also <a href="https://trac.edgewall.org/intertrac/source:branches/1.2-stable/sample-plugins/permissions" class="ext-link"><span class="icon"></span>sample-plugins/permissions</a> for more examples.</p><h3>AuthzPolicy</h3><h4>Configuration</h4><ul><li>Put a <a href="https://swapoff.org/files/authzpolicy.conf" class="ext-link"><span class="icon"></span>conf</a> file in a secure location on the server, not readable by users other than the webuser. If the  file contains non-ASCII characters, the UTF-8 encoding should be used.</li><li>Update your <code>trac.ini</code>:</li></ul><p>  1. modify the [TracIni#trac-section permission_policies] entry in the <code>[trac]</code> section:</p><pre class="wiki">[trac]
permission_policies = AuthzPolicy, ReadonlyWikiPolicy, DefaultPermissionPolicy, LegacyAttachmentPolicy
</pre><p>  1. add a new <code>[authz_policy]</code> section and point the <code>authz_file</code> option to the conf file:</p><pre class="wiki">[authz_policy]
authz_file = /some/trac/env/conf/authzpolicy.conf
</pre><p>  1. enable the plugin through <a href="/admin/general/plugin" class="ext-link"><span class="icon"></span>WebAdmin</a> or by editing the <code>[components]</code> section:</p><pre class="wiki">[components]
tracopt.perm.authz_policy.* = enabled
</pre><h4>Usage Notes</h4><p>Note the order in which permission policies are specified: policies are implemented in the sequence provided and therefore may override earlier policy specifications.</p><p>A policy will return either <code>True</code>, <code>False</code> or <code>None</code> for a given permission check. <code>True</code> is returned if the policy explicitly grants the permission. <code>False</code> is returned if the policy explicitly denies the permission. <code>None</code> is returned if the policy is unable to either grant or deny the permission.</p><p>NOTE: Only if the return value is <code>None</code> will the ''next'' permission policy be consulted. If none of the policies explicitly grants the permission, the final result will be <code>False</code>, i.e. permission denied.</p><p>The <code>authzpolicy.conf</code> file is a <code>.ini</code> style configuration file:</p><pre class="wiki">[wiki:PrivatePage@*]
john = WIKI_VIEW, !WIKI_MODIFY
jack = WIKI_VIEW
* =
</pre><ul><li>Each section of the config is a glob pattern used to match against a Trac resource descriptor. These descriptors are in the form:</li></ul><pre class="wiki">
&lt;realm&gt;:&lt;id&gt;@&lt;version&gt;[/&lt;realm&gt;:&lt;id&gt;@&lt;version&gt; ...]
</pre><p>Resources are ordered left to right, from parent to child. If any component is inapplicable, <code>*</code> is substituted. If the version pattern is not specified explicitly, all versions (<code>@*</code>) is added implicitly. Example: Match the <a href="/wiki/WikiStart">WikiStart</a> page:</p><pre class="wiki">[wiki:*]
[wiki:WikiStart*]
[wiki:WikiStart@*]
[wiki:WikiStart]
</pre><p>Example: Match the attachment <code>wiki:WikiStart@117/attachment:FOO.JPG@*</code> on <a href="/wiki/WikiStart">WikiStart</a>:</p><pre class="wiki">[wiki:*]
[wiki:WikiStart*]
[wiki:WikiStart@*]
[wiki:WikiStart@*/attachment:*]
[wiki:WikiStart@117/attachment:FOO.JPG]
</pre><ul><li>Sections are checked against the current Trac resource descriptor <strong>IN ORDER</strong> of appearance in the configuration file. <strong>ORDER IS CRITICAL</strong>.</li></ul><ul><li>Once a section matches, the current username is matched against the keys (usernames) of the section, <strong>IN ORDER</strong>. </li>  <li>If a key (username) is prefixed with a <code>@</code>, it is treated as a group. </li>  <li>If a value (permission) is prefixed with a <code>!</code>, the permission is denied rather than granted.</li></ul><p>The username will match any of 'anonymous', 'authenticated', &lt;username&gt; or '*', using normal Trac permission rules. || <strong>Note:</strong> Other groups which are created by user (e.g. by 'adding subjects to groups' on web interface page //Admin / Permissions//) cannot be used. See <a href="https://trac.edgewall.org/intertrac/ticket:5648" class="ext-link"><span class="icon"></span>#5648</a> for details about this missing feature. ||</p><p>For example, if the <code>authz_file</code> contains:</p><pre class="wiki">[wiki:WikiStart@*]
* = WIKI_VIEW

[wiki:PrivatePage@*]
john = WIKI_VIEW
* = !WIKI_VIEW
</pre><p>and the default permissions are set like this:</p><pre class="wiki">
john           WIKI_VIEW
jack           WIKI_VIEW
# anonymous has no WIKI_VIEW
</pre><p>Then: </p>  <ul><li>All versions of <a href="/wiki/WikiStart">WikiStart</a> will be viewable by everybody, including anonymous</li>  <li>PrivatePage will be viewable only by john</li>  <li>other pages will be viewable only by john and jack</li></ul><p>Groups:</p><pre class="wiki">[groups]
admins = john, jack
devs = alice, bob

[wiki:Dev@*]
@admins = TRAC_ADMIN
@devs = WIKI_VIEW
* =

[*]
@admins = TRAC_ADMIN
* =
</pre><p>Then:</p><ul><li>everything is blocked (whitelist approach), but</li><li>admins get all TRAC_ADMIN everywhere and</li><li>devs can view wiki pages.</li></ul><p>Some repository examples (Browse Source specific):</p><pre class="wiki"># A single repository:
[repository:test_repo@*]
john = BROWSER_VIEW, FILE_VIEW
# John has BROWSER_VIEW and FILE_VIEW for the entire test_repo

# The default repository (requires Trac 1.0.2 or later):
[repository:@*]
john = BROWSER_VIEW, FILE_VIEW
# John has BROWSER_VIEW and FILE_VIEW for the entire default repository

# All repositories:
[repository:*@*]
jack = BROWSER_VIEW, FILE_VIEW
# Jack has BROWSER_VIEW and FILE_VIEW for all repositories
</pre><p>Very granular repository access:</p><pre class="wiki"># John has BROWSER_VIEW and FILE_VIEW access to trunk/src/some/location/ only
[repository:test_repo@*/source:trunk/src/some/location/*@*]
john = BROWSER_VIEW, FILE_VIEW

# John has BROWSER_VIEW and FILE_VIEW access to only revision 1 of all files at trunk/src/some/location only
[repository:test_repo@*/source:trunk/src/some/location/*@1]
john = BROWSER_VIEW, FILE_VIEW

# John has BROWSER_VIEW and FILE_VIEW access to all revisions of 'somefile' at trunk/src/some/location only 
[repository:test_repo@*/source:trunk/src/some/location/somefile@*]
john = BROWSER_VIEW, FILE_VIEW

# John has BROWSER_VIEW and FILE_VIEW access to only revision 1 of 'somefile' at trunk/src/some/location only
[repository:test_repo@*/source:trunk/src/some/location/somefile@1]
john = BROWSER_VIEW, FILE_VIEW
</pre><p>Note: In order for Timeline to work/visible for John, we must add CHANGESET_VIEW to the above permission list.</p><h4>Missing Features</h4><p>Although possible with the DefaultPermissionPolicy handling (see Admin panel), fine-grained permissions still miss those grouping features (see <a href="https://trac.edgewall.org/intertrac/ticket:9573" class="ext-link"><span class="icon"></span>#9573</a>, <a href="https://trac.edgewall.org/intertrac/ticket:5648" class="ext-link"><span class="icon"></span>#5648</a>). Patches are partially available, see authz_policy.2.patch, part of <a href="https://trac.edgewall.org/intertrac/ticket:6680" class="ext-link"><span class="icon"></span>#6680</a>.</p><p>You cannot do the following:</p><pre class="wiki">[groups]
team1 = a, b, c
team2 = d, e, f
team3 = g, h, i
departmentA = team1, team2
</pre><p>Permission groups are not supported either, so you cannot do the following:</p><pre class="wiki">[groups]
permission_level_1 = WIKI_VIEW, TICKET_VIEW
permission_level_2  = permission_level_1, WIKI_MODIFY, TICKET_MODIFY
[*]
@team1 = permission_level_1
@team2 = permission_level_2
@team3 = permission_level_2, TICKET_CREATE
</pre><h3>AuthzSourcePolicy  (mod_authz_svn-like permission policy) #AuthzSourcePolicy</h3><p><code>AuthzSourcePolicy</code> can be used for restricting access to the repository. Granular permission control needs a definition file, which is the one used by Subversion's mod_authz_svn. </p><p>More information about this file format and about its usage in Subversion is available in the <a href="http://svnbook.red-bean.com/en/1.7/svn.serverconfig.pathbasedauthz.html" class="ext-link"><span class="icon"></span>Path-Based Authorization</a> section in the Server Configuration chapter of the svn book.</p><p>Example:</p><pre class="wiki">[/]
* = r

[/branches/calc/bug-142]
harry = rw
sally = r

[/branches/calc/bug-142/secret]
harry =
</pre> <ul><li><strong>/</strong> = ''Everyone has read access by default''</li> <li><strong>/branches/calc/bug-142</strong> = ''harry has read/write access, sally read only''</li> <li><strong>/branches/calc/bug-142/secret</strong> = ''harry has no access, sally has read access (inherited as a sub folder permission)''</li></ul><h4>Trac Configuration</h4><p>To activate granular permissions you __must__ specify the </p><pre class="wiki">authz_file</pre> option in the <code>[svn]</code> section of trac.ini. If this option is set to null or not specified, the permissions will not be used.<p></p><pre class="wiki">[svn]
authz_file = /path/to/svnaccessfile
</pre><p>If you want to support the use of the <code>[</code>''modulename''<code>:/</code>''some''<code>/</code>''path''<code>]</code> syntax within the <code>authz_file</code>, add:</p><pre class="wiki">authz_module_name = modulename
</pre><p>where ''modulename'' refers to the same repository indicated by the <code>&lt;name&gt;.dir</code> entry in the <code>[repositories]</code> section. As an example, if the <code>somemodule.dir</code> entry in the <code>[repositories]</code> section is <code>/srv/active/svn/somemodule</code>, that would yield the following:</p><pre class="wiki"> #!ini
[svn]
authz_file = /path/to/svnaccessfile
authz_module_name = somemodule
...
[repositories]
somemodule.dir = /srv/active/svn/somemodule 
</pre><p>where the svn access file, </p><pre class="wiki">/path/to/svnaccessfile</pre>, contains entries such as <pre class="wiki">[somemodule:/some/path]</pre>.<p></p><p><strong>Note:</strong> Usernames inside the Authz file __must__ be the same as those used inside trac. </p><p>As of version 0.12, make sure you have ''!AuthzSourcePolicy'' included in the permission_policies list in trac.ini, otherwise the authz permissions file will be ignored.</p><pre class="wiki">[trac]
permission_policies = AuthzSourcePolicy, ReadonlyWikiPolicy, DefaultPermissionPolicy, LegacyAttachmentPolicy
</pre><h4>Subversion Configuration</h4><p>The same access file is typically applied to the corresponding Subversion repository using an Apache directive like this:</p><pre class="wiki">&lt;Location /repos&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # our access control policy
  AuthzSVNAccessFile /path/to/svnaccessfile
&lt;/Location&gt;
</pre><p>For information about how to restrict access to entire projects in a multiple project environment see <a href="https://trac.edgewall.org/intertrac/wiki:TracMultipleProjectsSVNAccess" class="ext-link"><span class="icon"></span>wiki:TracMultipleProjectsSVNAccess</a>.</p><h3><a href="/wiki/ReadonlyWikiPolicy">ReadonlyWikiPolicy</a></h3><p>Since 1.1.2, the read-only attribute of wiki pages is enabled and enforced when <code>ReadonlyWikiPolicy</code> is in the list of active permission policies. The default for new Trac installations in 1.1.2 and later is:</p><pre class="wiki">
[trac]
permission_policies = ReadonlyWikiPolicy,
 DefaultPermissionPolicy,
 LegacyAttachmentPolicy
</pre><p>When upgrading from earlier versions of Trac, <code>ReadonlyWikiPolicy</code> will be appended to the list of <code>permission_policies</code> when upgrading the environment, provided that <code>permission_policies</code> has the default value. If any non-default <code>permission_polices</code> are active, <code>ReadonlyWikiPolicy</code> **will need to be manually added** to the list. A message will be echoed to the console when upgrading the environment, indicating if any action needs to be taken.</p><p>**!ReadonlyWikiPolicy must be listed <em>before</em> DefaultPermissionPolicy**. The latter returns <code>True</code> to allow modify, delete or rename actions when the user has the respective <code>WIKI_*</code> permission, without consideration for the read-only attribute.</p><p>The <code>ReadonlyWikiPolicy</code> returns <code>False</code> to deny modify, delete and rename actions on wiki pages when the page has the read-only attribute set and the user does not have <code>WIKI_ADMIN</code>, regardless of <code>WIKI_MODIFY</code>, <code>WIKI_DELETE</code> and <code>WIKI_RENAME</code> permissions. It returns <code>None</code> for all other cases.</p><p>When active, the <a href="#AuthzPolicy" class="ext-link"><span class="icon"></span>#AuthzPolicy</a> should therefore come before <code>ReadonlyWikiPolicy</code>, allowing it to grant or deny the actions on individual resources, which is the usual ordering for <code>AuthzPolicy</code> in the <code>permission_policies</code> list.</p><pre class="wiki">
[trac]
permission_policies = AuthzPolicy,
 ReadonlyWikiPolicy,
 DefaultPermissionPolicy,
 LegacyAttachmentPolicy
</pre><p>The placement of <a href="#AuthzSourcePolicy" class="ext-link"><span class="icon"></span>#AuthzSourcePolicy</a> relative to <code>ReadonlyWikiPolicy</code> does not matter since they don't perform checks on the same realms.</p><p>For all other permission policies, the user will need to decide the proper ordering. Generally, if the permission policy should be capable of overriding the check performed by <code>ReadonlyWikiPolicy</code>, it should come before <code>ReadonlyWikiPolicy</code> in the list. If the <code>ReadonlyWikiPolicy</code> should override the check performed by another permission policy, as is the case for <code>DefaultPermissionPolicy</code>, then <code>ReadonlyWikiPolicy</code> should come first.</p><h2>Debugging permissions</h2><p>In trac.ini set:</p><pre class="wiki">[logging]
log_file = trac.log
log_level = DEBUG
log_type = file
</pre><p>Display the trac.log to understand what checks are being performed:</p><pre class="wiki">tail -n 0 -f log/trac.log | egrep '\\[perm\\]|\\[authz_policy\\]'
</pre><p>See the sourced documentation of the plugin for more info.</p><p></p><hr><p></p><p>See also: <a href="/wiki/TracPermissions">TracPermissions</a>,</p><p><a href="https://trac-hacks.org/wiki/FineGrainedPageAuthzEditorPlugin" class="ext-link"><span class="icon"></span>TracHacks:FineGrainedPageAuthzEditorPlugin</a> for a simple editor plugin.</p>

  </div>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
