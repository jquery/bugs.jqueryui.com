<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">TracRepositoryAdmin</title>
    <meta name="description" content="Static archive of the old bugs.jqueryui.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/yIpytWuWSz.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery UI issues have moved to <a href="https://github.com/jquery/jquery-ui/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. <br>Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery UI Bugs Home">
            <img src="/img/logo.svg" width="253" alt="jQuery UI">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus" class="flex-column">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery UI sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui active">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery UI navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jqueryui.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://jqueryui.com/demos/">
                    Demos &amp; Documentation
                  </a>
                </li>
                <li class="jq-themes">
                  <a href="https://jqueryui.com/themeroller/">
                    Themes
                  </a>
                </li>
                <li class="jq-development">
                  <a href="https://jqueryui.com/development/">
                    Development
                  </a>
                </li>
                <li class="jq-support">
                  <a href="https://jqueryui.com/support/">
                    Support
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main id="skip" class="flex-column white-box">
        <h2 class="visually-hidden">Search and Top Navigation</h2>
        <div class="flex-row flex-end-center">
          <div id="search"></div>
        </div>
        <nav id="jq-topnav" class="flex-column flex-start-center">
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="flex-column">
          

<div class="wiki flex-column">
  <div class="breadcrumbs-nav flex-row">
    <a href="/" class="breadcrumbs-nav-first">wiki:</a>
    
      <a href="/wiki/TracRepositoryAdmin/">TracRepositoryAdmin</a>
    
  </div>
  <nav class="content-nav">
    <ul class="flex-row">
      <li>
        <a href="/">Start Page</a>
      </li>
      <li>
        <a href="/wiki/TitleIndex">Index</a>
      </li>
    </ul>
  </nav>
  <div class="wiki-content">
    
<h1>Repository Administration</h1><h2>Quick start #QuickStart</h2> <ul><li>Enable the repository connector(s) for the version control system(s) that you will use.</li> <li>Add repositories through the <em>Repositories</em> admin panel, with <code>trac-admin</code> or in the <code>[repositories]</code> section of <a href="/wiki/TracIni#repositories-section" class="ext-link"><span class="icon"></span>trac.ini</a>.</li> <li>Set up a call to <code>trac-admin $ENV changeset added $REPO $REV</code> in the post-commit hook of each repository. Additionally, add a call to <code>trac-admin $ENV changeset modified $REPO $REV</code> in the post-revprop-change hook of repositories allowing revision property changes.</li> <li>Make sure the user under which your hooks are run has write access to the Trac environment, or use a tool like <code>sudo</code> to temporarily elevate privileges.</li></ul><h2>Enabling the components</h2><p>Support for version control systems is provided by optional components distributed with Trac, which are disabled by default <em>(since 1.0)</em>. Subversion and Git must be explicitly enabled if you wish to use them.</p><p>The version control systems can be enabled by adding the following to the <code>[components]</code> section of your [TracIni#components-section trac.ini], or enabling the components in the <em>Plugins</em> admin panel.</p><pre class="wiki">tracopt.versioncontrol.svn.* = enabled
</pre><pre class="wiki">tracopt.versioncontrol.git.* = enabled
</pre><h2>Specifying repositories #Repositories</h2><p>Trac supports multiple repositories per environment, and the repositories may be for different version control system types. Each repository must be defined in a repository configuration provider, the two supported by default are the <a href="#ReposDatabase" class="ext-link"><span class="icon"></span>database store</a> and the <a href="#ReposTracIni" class="ext-link"><span class="icon"></span>trac.ini configuration file</a>. A repository should not be defined in multiple configuration providers.</p><p>It is possible to define aliases of repositories, that act as "pointers" to real repositories. This can be useful when renaming a repository, to avoid breaking links to the old name.</p><p>A number of attributes can be associated with each repository. The attributes define the repository's location, type, name and how it is displayed in the source browser. The following attributes are supported:</p><p>||=<strong>Attribute</strong> =||=<strong>Description</strong> =||</p><p>||<code>alias</code> ||\\</p><p>||A repository having an <code>alias</code> attribute is an alias to a real repository. All <a href="/wiki/TracLinks">TracLinks</a> referencing the alias resolve to the aliased repository. Note that multiple indirection is not supported, so an alias must always point to a real repository. The <code>alias</code> and <code>dir</code> attributes are mutually exclusive. ||</p><p>||<code>description</code> ||\\</p><p>||The text specified in the <code>description</code> attribute is displayed below the top-level entry for the repository in the source browser. It supports <a href="/wiki/WikiFormatting">WikiFormatting</a>. ||</p><p>||<code>dir</code> ||\\</p><p>||The <code>dir</code> attribute specifies the location of the repository in the filesystem. It corresponds to the value previously specified in the option <code>[trac] repository_dir</code>. The <code>alias</code> and <code>dir</code> attributes are mutually exclusive. ||</p><p>||<code>hidden</code> ||When set to <code>true</code>, the repository is hidden from the repository index page in the source browser. Browsing the repository is still possible, and links referencing the repository remain valid. ||</p><p>||<code>sync_per_request</code>||When set to <code>true</code> the repository will be synced on every request. This is not recommended, instead a post-commit hook should be configured to provide <a href="#ExplicitSync" class="ext-link"><span class="icon"></span>explicit synchronization</a> and <code>sync_per_request</code> should be set to <code>false</code>.||</p><p>||<code>type</code> ||The <code>type</code> attribute sets the type of version control system used by the repository. Trac supports Subversion and Git out-of-the-box, and plugins add support for many other systems. If <code>type</code> is not specified, it defaults to the value of the <code>[versioncontrol] default_repository_type</code> option. ||</p><p>||<code>url</code> ||The <code>url</code> attribute specifies the root URL to be used for checking out from the repository. When specified, a "Repository URL" link is added to the context navigation links in the source browser, that can be copied into the tool used for creating the working copy. ||</p><p>A repository <code>name</code> and one of <code>alias</code> or <code>dir</code> attributes are mandatory. All others are optional.</p><p>For some version control systems, it is possible to specify not only the path to the repository in the <code>dir</code> attribute, but also a ''scope'' within the repository. Trac will then only show information related to the files and changesets below that scope. The Subversion backend for Trac supports this. For other types, check the corresponding plugin's documentation.</p><p>After adding a repository, the cache for that repository must be re-synchronized once with the <code>trac-admin $ENV repository resync</code> command.</p><p> <code>repository resync &lt;repos&gt;</code>::</p><p>   Re-synchronize Trac with a repository.</p><h3>In <code>trac.ini</code> #ReposTracIni</h3><p>Repositories and repository attributes can be specified in the <code>[repositories]</code> section of <a href="/wiki/TracIni#repositories-section" class="ext-link"><span class="icon"></span>trac.ini</a>. Every attribute consists of a key structured as <code>{name}.{attribute}</code> and the corresponding value separated with an equal sign (<code>=</code>). The name of the default repository is empty.</p><p>The main advantage of specifying repositories in <code>trac.ini</code> is that they can be inherited from a global configuration (see the <a href="/wiki/TracIni#GlobalConfiguration" class="ext-link"><span class="icon"></span>global configuration</a> section of <a href="/wiki/TracIni">TracIni</a>). One drawback is that, due to limitations in the <code>ConfigParser</code> class used to parse <code>trac.ini</code>, the repository name is always all-lowercase.</p><p>The following example defines two Subversion repositories named <code>project</code> and <code>lib</code>, and an alias to <code>project</code> as the default repository. This is a typical use case where a Trac environment previously had a single repository (the <code>project</code> repository), and was converted to multiple repositories. The alias ensures that links predating the change continue to resolve to the <code>project</code> repository.</p><pre class="wiki">[repositories]
project.dir = /var/repos/project
project.description = This is the ''main'' project repository.
project.type = svn
project.url = http://example.com/svn/project
project.hidden = true

lib.dir = /var/repos/lib
lib.description = This is the secondary library code.
lib.type = svn
lib.url = http://example.com/svn/lib

.alias = project
</pre><p>Note that <code>name.alias = target</code> makes <code>name</code> an alias for the <code>target</code> repo, not the other way around.</p><h3>In the database #ReposDatabase</h3><p>Repositories can also be specified in the database, using either the "Repositories" admin panel under "Version Control", or the <code>trac-admin $ENV repository</code> commands.</p><p>The admin panel shows the list of all repositories defined in the Trac environment. It allows adding repositories and aliases, editing repository attributes and removing repositories. Note that repositories defined in <code>trac.ini</code> are displayed but cannot be edited.</p><p>The following <a href="/wiki/TracAdmin" class="ext-link"><span class="icon"></span>trac-admin</a> commands can be used to perform repository operations from the command line.</p><p> <code>repository add &lt;repos&gt; &lt;dir&gt; [type]</code>::</p><p>   Add a repository <code>&lt;repos&gt;</code> located at <code>&lt;dir&gt;</code>, and optionally specify its type.</p><p> <code>repository alias &lt;name&gt; &lt;target&gt;</code>::</p><p>   Create an alias <code>&lt;name&gt;</code> for the repository <code>&lt;target&gt;</code>.</p><p> <code>repository remove &lt;repos&gt;</code>::</p><p>   Remove the repository <code>&lt;repos&gt;</code>.</p><p> <code>repository set &lt;repos&gt; &lt;key&gt; &lt;value&gt;</code>::</p><p>   Set the attribute <code>&lt;key&gt;</code> to <code>&lt;value&gt;</code> for the repository <code>&lt;repos&gt;</code>. </p><p>Note that the default repository has an empty name, so it will likely need to be quoted when running <code>trac-admin</code> from a shell. Alternatively, the name "<code>(default)</code>" can be used instead, for example when running <code>trac-admin</code> in interactive mode.</p><h2>Repository caching</h2><p>The Subversion and Git repository connectors support caching, which improves the performance browsing the repository, viewing logs and viewing changesets. Cached repositories must be <a href="#Synchronization" class="ext-link"><span class="icon"></span>synchronized</a>; either explicit or implicit synchronization can be used. When searching changesets, only cached repositories are searched.</p><p>Subversion repositories are cached unless the type is <code>direct-svnfs</code>. Git repositories are cached when <code>[git]</code> <a href="/wiki/TracIni#git-section" class="ext-link"><span class="icon"></span>cached_repository</a> is <code>true</code>.</p><h2>Repository synchronization #Synchronization</h2><p>Prior to 0.12, Trac synchronized its cache with the repository on every HTTP request. This approach is not very efficient and not practical anymore with multiple repositories. For this reason, explicit synchronization through post-commit hooks was added. </p><p>There is also new functionality in the form of a repository listener extension point ''(IRepositoryChangeListener)'' that is triggered by the post-commit hook when a changeset is added or modified, and can be used by plugins to perform actions on commit.</p><h3>Mercurial Repositories</h3><p>Please note that at the time of writing, no initial resynchronization or any hooks are necessary for Mercurial repositories - see <a href="https://trac.edgewall.org/ticket/9485" class="ext-link"><span class="icon"></span>9485</a> for more information. </p><h3>Explicit synchronization #ExplicitSync</h3><p>This is the preferred method of repository synchronization. It requires setting the <code>sync_per_request</code> attribute to <code>false</code>, and adding a call to <code>trac-admin</code> in the <code>post-commit</code> hook of each repository. Additionally, if a repository allows changing revision metadata, a call to <code>trac-admin</code> must be added to the <code>post-revprop-change</code> hook as well.</p><p> <code>changeset added &lt;repos&gt; &lt;rev&gt; [...]</code>::</p><p>   Notify Trac that one or more changesets have been added to a repository.</p><p> <code>changeset modified &lt;repos&gt; &lt;rev&gt; [...]</code>::</p><p>   Notify Trac that metadata on one or more changesets in a repository has been modified.</p><p>The <code>&lt;repos&gt;</code> argument can be either a repository name (use "<code>(default)</code>" for the default repository) or the path to the repository.</p><p>Note that you may have to set the environment variable <code>PYTHON_EGG_CACHE</code> to the same value as was used for the web server configuration before calling <code>trac-admin</code>, if you changed it from its default location. See <a href="/wiki/TracPlugins" class="ext-link"><span class="icon"></span>Trac Plugins</a> for more information.</p><h4>Subversion</h4><h5>Using <code>trac-svn-hook</code></h5><p>In a Unix environment, the simplest way to configure explicit synchronization is by using the <a href="https://trac.edgewall.org/intertrac/source:branches/1.2-stable/contrib/trac-svn-hook" class="ext-link"><span class="icon"></span>contrib/trac-svn-hook</a> script. <code>trac-svn-hook</code> starts <code>trac-admin</code> asynchronously to avoid slowing the commit and log editing operations. The script comes with a number of safety checks and usage advice. Output is written to a log file with prefix <code>svn-hooks-</code> in the environment <code>log</code> directory, which can make configuration issues easier to debug.</p><p>There's no equivalent <code>trac-svn-hook.bat</code> for Windows yet, but the script can be run by Cygwin's bash.</p><p>Follow the help in the documentation header of the script to configure <code>trac-svn-hook</code>. Configuring the hook environment variables is made easier in Subversion 1.8 by using the <a href="http://svnbook.red-bean.com/en/1.8/svn.reposadmin.create.html#svn.reposadmin.hooks.configuration" class="ext-link"><span class="icon"></span>hook script environment</a> configuration. Rather than directly editing <code>trac-svn-hook</code> to set the environment variables, they can be configured through the repository <code>conf/hooks-env</code> file. Replace the <a href="https://trac.edgewall.org/intertrac/source:branches/1.2-stable/contrib/trac-svn-hook@:65-67#L61" class="ext-link"><span class="icon"></span>configuration section</a> with:</p><pre class="wiki">export PATH=$PYTHON_BIN:$PATH
export LD_LIBRARY_PATH=$PYTHON_LIB:$LD_LIBRARY_PATH
</pre><p>and set the variables <code>TRAC_ENV</code>, <code>PYTHON_BIN</code> and <code>PYTHON_LIB</code> in the <code>hooks-env</code> file. Here is an example, using a Python virtual environment at <code>/usr/local/venv</code>:</p><pre class="wiki">[default]
TRAC_ENV=/var/trac/project-1
PYTHON_BIN=/usr/local/venv/bin
PYTHON_LIB=/usr/local/venv/lib
</pre><h5>Writing Your Own Hook Script</h5><p>The following examples are complete post-commit and post-revprop-change scripts for Subversion. They should be edited for the specific environment, marked executable (where applicable) and placed in the <code>hooks</code> directory of each repository. On Unix (<code>post-commit</code>):</p><pre class="wiki">#!/bin/sh
export PYTHON_EGG_CACHE="/path/to/dir"
/usr/bin/trac-admin /path/to/env changeset added "$1" "$2"
</pre><p>Note: Check with <code>whereis trac-admin</code>, whether <code>trac-admin</code> is really installed under <code>/usr/bin/</code> or maybe under <code>/usr/local/bin/</code> and adapt the path.</p><p>On Windows (<code>post-commit.cmd</code>):</p><pre class="wiki">@C:\\Python26\\Scripts\\trac-admin.exe C:\\path\\to\\env changeset added "%1" "%2"
</pre><p>The post-revprop-change hook for Subversion is very similar. On Unix (<code>post-revprop-change</code>):</p><pre class="wiki">#!/bin/sh
export PYTHON_EGG_CACHE="/path/to/dir"
/usr/bin/trac-admin /path/to/env changeset modified "$1" "$2"
</pre><p>On Windows (<code>post-revprop-change.cmd</code>):</p><pre class="wiki">@C:\\Python26\\Scripts\\trac-admin.exe C:\\path\\to\\env changeset modified "%1" "%2"
</pre><p>The Unix variants above assume that the user running the Subversion commit has write access to the Trac environment, which is the case in the standard configuration where both the repository and Trac are served by the web server. If you access the repository through another means, for example <code>svn+ssh://</code>, you may have to run <code>trac-admin</code> with different privileges, for example by using <code>sudo</code>.</p><p>See the <a href="http://svnbook.red-bean.com/en/1.7/svn.reposadmin.create.html#svn.reposadmin.create.hooks" class="ext-link"><span class="icon"></span>section about hooks</a> in the Subversion book for more information. Other repository types will require different hook setups.</p><h4>Git</h4><p>Git hooks can be used in the same way for explicit syncing of Git repositories.  If your git repository is one that gets committed to directly on the machine that hosts trac, add the following to the <code>hooks/post-commit</code> file in your git repo (note: this will do nothing if you only update the repo by pushing to it):</p><pre class="wiki">#!/bin/sh 
REV=$(git rev-parse HEAD) 
trac-admin /path/to/env changeset added &lt;repos&gt; $REV 
</pre><p>Alternately, if your repository is one that only gets pushed to, add the following to the <code>hooks/post-receive</code> file in the repo:</p><pre class="wiki">#!/bin/sh
tracenv=/path/to/env     # change with your Trac environment's path
repos=                   # change with your repository's name
while read oldrev newrev refname; do
    if [ "$oldrev" = 0000000000000000000000000000000000000000 ]; then
        git rev-list --reverse "$newrev" --
    else
        git rev-list --reverse "$newrev" "^$oldrev" --
    fi | xargs trac-admin "$tracenv" changeset added "$repos"
done
</pre><p>The <code>&lt;repos&gt;</code> argument can be either a repository name (use "<code>(default)</code>" for the default repository) or the path to the repository.</p><h4>Mercurial</h4><p>For Mercurial, add the following entries to the <code>.hgrc</code> file of each repository accessed by Trac (if <a href="https://trac.edgewall.org/intertrac/TracMercurial" class="ext-link"><span class="icon"></span>TracMercurial</a> is installed in a Trac <code>plugins</code> directory, download <a href="https://trac.edgewall.org/intertrac/source:mercurial-plugin/tracext/hg/hooks.py" class="ext-link"><span class="icon"></span>hooks.py</a> and place it somewhere accessible):</p><pre class="wiki">[hooks]
; If mercurial-plugin is installed globally
commit = python:tracext.hg.hooks.add_changesets
changegroup = python:tracext.hg.hooks.add_changesets

; If mercurial-plugin is installed in a Trac plugins directory
commit = python:/path/to/hooks.py:add_changesets
changegroup = python:/path/to/hooks.py:add_changesets

[trac]
env = /path/to/env
trac-admin = /path/to/trac-admin
</pre><h3>Per-request synchronization #PerRequestSync</h3><p>If the post-commit hooks are not available, the environment can be set up for per-request synchronization. In that case, the <code>sync_per_request</code> attribute for each repository in the database and in <a href="/wiki/TracIni#trac-section" class="ext-link"><span class="icon"></span>trac.ini</a> must be set to <code>true</code>.</p><p>Note that in this case, the changeset listener extension point is not called, and therefore plugins using it will not work correctly.</p><h2>Automatic changeset references in tickets</h2><p>You can automatically add a reference to the changeset as a ticket comment whenever changes are committed to the repository. The description of the commit needs to contain one of the following formulas:</p> <ul><li><strong><code>Refs #123</code></strong> - to reference this changeset in <code>#123</code> ticket</li> <li><strong><code>Fixes #123</code></strong> - to reference this changeset and close <code>#123</code> ticket with the default status ''fixed''</li></ul><p>This functionality requires installing a post-commit hook as described in <a href="#ExplicitSync" class="ext-link"><span class="icon"></span>#ExplicitSync</a>, and enabling the optional commit updater components by adding the following line to the <code>[components]</code> section of your <a href="/wiki/TracIni#components-section" class="ext-link"><span class="icon"></span>trac.ini</a>, or enabling the components in the <em>Plugins</em> admin panel.</p><pre class="wiki">tracopt.ticket.commit_updater.* = enabled
</pre><p>For more information, see the documentation of the <code>CommitTicketUpdater</code> component in the <em>Plugins</em> admin panel and the <a href="https://trac.edgewall.org/intertrac/CommitTicketUpdater" class="ext-link"><span class="icon"></span>CommitTicketUpdater</a> page.</p><h2>Troubleshooting</h2><h3>My trac-post-commit-hook doesn't work anymore #trac-post-commit-hook</h3><p>You must now use the optional components from <code>tracopt.ticket.commit_updater.*</code>, which you can activate through the Plugins panel in the Administrative part of the web interface, or by directly modifying the [TracIni#components-section "[components]"] section in the trac.ini. Be sure to use <a href="#ExplicitSync" class="ext-link"><span class="icon"></span>explicit synchronization</a> as explained above.</p><p>See <a href="https://trac.edgewall.org/intertrac/CommitTicketUpdater#Troubleshooting" class="ext-link"><span class="icon"></span>CommitTicketUpdater#Troubleshooting</a> for more troubleshooting tips.</p>

  </div>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
